---
id: load-service-bindings-from-environment
title: Load Service Bindings within various Environments
hide_title: false
hide_table_of_contents: false
sidebar_label: Loading Service Bindings
description: This article describes how to leverage the Service Binding Loader API of the SAP Cloud SDK for Java to read service information in different environments.
keywords:
  - sap
  - cloud
  - sdk
  - java
  - OSB
  - service
  - binding
  - loader
---

## Load Service Binding Information

The SAP Cloud SDK leverages the [BTP Environment Variable Access](https://github.com/SAP/btp-environment-variable-access) library (also known as the _Service Binding Library_).
Therefore, loading service bindings from different platforms can be achieved by including the corresponding modules of the _Service Binding Library_ depending on your needs.

For example, if you are planning to deploy your application on Cloud Foundry, service bindings are contained in the `VCAP_SERVICES` environment variable.
The [`com.sap.cloud.environment.servicebinding:java-sap-vcap-services`](https://search.maven.org/search?q=g:com.sap.cloud.environment.servicebinding%20AND%20a:java-sap-vcap-services) dependency is designed to do exactly that.
Therefore, including the dependency is already enough to support that usecase.
If you are going to deploy your application additionally to a K8s based environment, then adding the [`com.sap.cloud.environment.servicebinding:java-sap-service-operator`](https://search.maven.org/search?q=g:com.sap.cloud.environment.servicebinding%20AND%20a:java-sap-service-operator) dependency should be sufficient.

:::note Note

As the name suggestes, the `java-sap-service-operator` module is designed to load service bindings that are created via the [SAP BTP Service Operator](https://github.com/SAP/sap-btp-service-operator).

:::

For more details, please refer to the [documentation of the _Service Binding Library_](https://github.com/SAP/btp-environment-variable-access).

## Customizing the Service Binding Loading

Application can customize the way service bindings are loaded when the [`cloudplatform-core-scp-cf`](https://search.maven.org/artifact/com.sap.cloud.sdk.cloudplatform/cloudplatform-core-scp-cf) module is used.
To do that, use the `ScpCfCloudPlatform#setServiceBindingAccessor(ServiceBindingAccessor)` method.

In testing scenarios, for example, it might be needed to mock the service bindings that should be used by the SAP Cloud SDK.
This can easily be achieved through the following code:

```java
final ScpCfCloudPlatform cloudPlatform = new ScpCfCloudPlatform();
cloudPlatform.setServiceBindingAccessor(() -> Collections.singletonList(mock(ServiceBinding.class)));
```

### Default Behavior

If nothing else has been specified, i.e. the `ScpCfCloudPlatform#setServiceBindingAccessor(ServiceBindingAccessor)` method hasn't been used, the SAP Cloud SDK will automatically use the `DefaultServiceBindingAccessor#getInstance` to load service bindings.

:::tip Tip

The SAP Cloud SDK will always get the default `ServiceBindingAccessor` (through the `DefaultServiceBindingAccessor#getInstance` method) whenever the service bindings are requested.
That way, changing the default `ServiceBindingAccessor` (through the `DefaultServiceBindingAccessor#setInstance` method) will also affect the SAP Cloud SDK **if nothing else has been specified explicitly**.

:::

This default behavior can always be enabled by using `ScpCfCloudPlatform.setServiceBindingAccessor(null)`.

### Custom _Environment Variable Reader_

:::danger Bad Practice

The below approach is considered bad practice and exists mainly for compatibility.
Please prefer the `ScpCfCloudPlatform#setServiceBindingAccessor` API whenever possible.

:::

In addition to the `ScpCfCloudPlatform#setServiceBindingAccessor` API, modifying the _environment variable reader_ via the `CloudPlatform#setEnvironmentVariableReader` method will also affect the [`ServiceBindingAccessor`](https://github.com/SAP/btp-environment-variable-access/blob/main/api-parent/access-api/src/main/java/com/sap/cloud/environment/servicebinding/api/ServiceBindingAccessor.java) used by the `ScpCfCloudPlatform` instance.
When this method is used, a custom `ServiceBindingAccessor` will be created by the `ScpCfCloudPlatform` in the following way:

1. Use the _Service Loader Pattern_ to get a list of `ServiceBindingAccessor` instances.
2. If the lists contains an instance of [`SapVcapServicesServiceBindingAccessor`](https://github.com/SAP/btp-environment-variable-access/blob/main/sap-vcap-services/src/main/java/com/sap/cloud/environment/servicebinding/SapVcapServicesServiceBindingAccessor.java), replace it with a new `SapVcapServicesServiceBindingAccessor` instance that uses the custom _environment variable reader_ (instead of `System.getenv`).
3. Combine the results of the `ServiceBindingAccessor` instances using the [`ServiceBindingMerger`](https://github.com/SAP/btp-environment-variable-access/blob/main/api-parent/access-api/src/main/java/com/sap/cloud/environment/servicebinding/api/ServiceBindingMerger.java).<br/>
**Note**: The `ServiceBindingMerger` will only consider unique service bindings.
4. Lastly, to reduce computational effort for consecutive lookups, use a [`SimpleServiceBindingCache`](https://github.com/SAP/btp-environment-variable-access/blob/main/api-parent/access-api/src/main/java/com/sap/cloud/environment/servicebinding/api/SimpleServiceBindingCache.java).
