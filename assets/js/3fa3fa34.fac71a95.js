"use strict";(self.webpackChunksap_cloud_sdk_documentation=self.webpackChunksap_cloud_sdk_documentation||[]).push([[43],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=d(n),m=i,h=u["".concat(l,".").concat(m)]||u[m]||c[m]||o;return n?a.createElement(h,r(r({ref:t},p),{},{components:n})):a.createElement(h,r({ref:t},p))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var d=2;d<o;d++)r[d]=n[d];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},76168:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>s,metadata:()=>d,toc:()=>c});var a=n(87462),i=(n(67294),n(3905)),o=n(74866),r=n(85162);const s={id:"destination-service",title:"Use Destinations To Connect To Other Systems and Services",hide_title:!1,hide_table_of_contents:!1,sidebar_label:"Destinations",description:"This article describes how the SAP Cloud SDK for Java can be used to establish connections to other systems and services like SAP S/4HANA or SAP Business Technology Platform services.",keywords:["sap","cloud","sdk","destination","java","connectivity"]},l=void 0,d={unversionedId:"features/connectivity/destination-service",id:"features/connectivity/destination-service",title:"Use Destinations To Connect To Other Systems and Services",description:"This article describes how the SAP Cloud SDK for Java can be used to establish connections to other systems and services like SAP S/4HANA or SAP Business Technology Platform services.",source:"@site/docs-java/features/connectivity/destinations.mdx",sourceDirName:"features/connectivity",slug:"/features/connectivity/destination-service",permalink:"/cloud-sdk/docs/java/features/connectivity/destination-service",draft:!1,editUrl:"https://github.com/SAP/cloud-sdk/edit/main/docs-java/features/connectivity/destinations.mdx",tags:[],version:"current",frontMatter:{id:"destination-service",title:"Use Destinations To Connect To Other Systems and Services",hide_title:!1,hide_table_of_contents:!1,sidebar_label:"Destinations",description:"This article describes how the SAP Cloud SDK for Java can be used to establish connections to other systems and services like SAP S/4HANA or SAP Business Technology Platform services.",keywords:["sap","cloud","sdk","destination","java","connectivity"]},sidebar:"docsJavaSidebar",previous:{title:"BAPI/RFC",permalink:"/cloud-sdk/docs/java/features/bapi-and-rfc/overview"},next:{title:"HttpClient",permalink:"/cloud-sdk/docs/java/features/connectivity/http-client"}},p={},c=[{value:"Accessing Destinations",id:"accessing-destinations",level:2},{value:"Supported Authentication Flows",id:"supported-authentication-flows",level:2},{value:"Integrated Multi-Tenancy",id:"integrated-multi-tenancy",level:3},{value:"Supported Proxy Types",id:"supported-proxy-types",level:2},{value:"Decorating Destinations",id:"decorating-destinations",level:2},{value:"HTTP Destinations",id:"http-destinations",level:3},{value:"BAPI Destinations",id:"bapi-destinations",level:3},{value:"Registering Destinations at Runtime",id:"registering-destinations-at-runtime",level:2},{value:"Enabling mTLS for Application to Destination communication",id:"enabling-mtls-for-application-to-destination-communication",level:3},{value:"Provide Headers for Destinations",id:"provide-headers-for-destinations",level:2},{value:"How It Works",id:"how-it-works",level:3},{value:"Implement Own Header Provider",id:"implement-own-header-provider",level:3},{value:"Implement the Interface <code>DestinationHeaderProvider</code>",id:"implement-the-interface-destinationheaderprovider",level:4},{value:"Make Interface Implementation Accessible",id:"make-interface-implementation-accessible",level:4},{value:"Add Headers via Destination Properties",id:"add-headers-via-destination-properties",level:3},{value:"Provide Query Parameters for Destinations",id:"provide-query-parameters-for-destinations",level:2},{value:"How It Works",id:"how-it-works-1",level:3},{value:"Add Query Parameters via Destination Properties",id:"add-query-parameters-via-destination-properties",level:3},{value:"Retrieving Destinations",id:"retrieving-destinations",level:2},{value:"Get All Destinations From the Destination Service on Cloud Foundry",id:"get-all-destinations-from-the-destination-service-on-cloud-foundry",level:3},{value:"Configuring Timeout Durations When Querying the Destination Service on Cloud Foundry",id:"configuring-timeout-durations-when-querying-the-destination-service-on-cloud-foundry",level:4},{value:"Configuring Caching When Querying the Destination Service on Cloud Foundry",id:"configuring-caching-when-querying-the-destination-service-on-cloud-foundry",level:4},{value:"Building Destination Options",id:"building-destination-options",level:4},{value:"Retrieval Strategy Options",id:"retrieval-strategy-options",level:5},{value:"Token Exchange Options",id:"token-exchange-options",level:5},{value:"Accessing Destination Properties",id:"accessing-destination-properties",level:2},{value:"Configure HTTP Destinations for Local Development Environment",id:"configure-http-destinations-for-local-development-environment",level:2},{value:"Background: Destination Retrieval on SAP Business Technology Platform",id:"background-destination-retrieval-on-sap-business-technology-platform",level:3},{value:"Automatically Inject Service bindings via Cloud Application Programming Development Kit",id:"automatically-inject-service-bindings-via-cloud-application-programming-development-kit",level:3},{value:"Configure Destinations Manually",id:"configure-destinations-manually",level:3},{value:"Destinations With Proxy Type <code>Internet</code>",id:"destinations-with-proxy-type-internet",level:4},{value:"Destinations With Proxy Type <code>OnPremise</code>",id:"destinations-with-proxy-type-onpremise",level:4},{value:"Create and Provide <code>VCAP_SERVICES</code> Variable",id:"create-and-provide-vcap_services-variable",level:4},{value:"Reach On-Premise Service from the SAP Business Application Studio",id:"reach-on-premise-service-from-the-sap-business-application-studio",level:4},{value:"Skip Destination Creation Step for Certain Authentication Types on Cloud Foundry",id:"skip-destination-creation-step-for-certain-authentication-types-on-cloud-foundry",level:4},{value:"Enable Access to SAP Business Technology Platform Connectivity Service",id:"enable-access-to-sap-business-technology-platform-connectivity-service",level:4}],u={toc:c};function m(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The SAP Cloud SDK offers some basic functionality that helps with connecting to other systems and services like SAP S/4HANA Cloud.\nThe SAP Cloud SDK introduces the general concept of a ",(0,i.kt)("inlineCode",{parentName:"p"},"Destination")," which holds basic information about how to connect to such a system.\nThat could for instance be a ",(0,i.kt)("inlineCode",{parentName:"p"},"url"),", a username, and password for basic authentication or some custom headers."),(0,i.kt)("p",null,"This concept is integrated with the ",(0,i.kt)("a",{parentName:"p",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/7e306250e08340f89d6c103e28840f30.html"},"Destination Service")," that is available on the SAP Business Technology Platform.\nIf the application has a service binding to this service in place the SAP Cloud SDK will provide access to these destinations."),(0,i.kt)("h2",{id:"accessing-destinations"},"Accessing Destinations"),(0,i.kt)("p",null,"In general destinations are accessed through the ",(0,i.kt)("inlineCode",{parentName:"p"},"DestinationAccessor"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'DestinationAccessor.getDestination("my-destination");\n')),(0,i.kt)("p",null,"This will look up the destination in the destination service if the application is running on SAP Business Technology Platform.\nOther sources like the environment variables are also considered."),(0,i.kt)("admonition",{title:"Authentication Flows",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Authentication flows like ",(0,i.kt)("strong",{parentName:"p"},"OAuth 2.0 Client Credentials")," and others are usually performed by the Destination Service.\nThey are executed when querying the destination information and the resulting authorization information will be included in the response."),(0,i.kt)("p",{parentName:"admonition"},"See the note on ",(0,i.kt)("a",{parentName:"p",href:"#supported-authentication-flows"},"supported authentication flows"),".")),(0,i.kt)("admonition",{title:"Destinations are cached for 5 minutes",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"To minimize the runtime overhead of finding destinations, the SAP Cloud SDK uses caching to internally maintain a list of already retrieved destinations.\nTherefore, subsequent calls to ",(0,i.kt)("inlineCode",{parentName:"p"},'DestinationAccessor.getDestination("my-destination");')," will be served from that cache instead of performing the look up over and over again.\nBy default, cache entries will automatically be invalidated 5 minutes after their initial creation.\nThe caching behavior can be customized.\nPlease refer to ",(0,i.kt)("a",{parentName:"p",href:"#configuring-caching-when-querying-the-destination-service-on-cloud-foundry"},"our section about configuring the cache configuration")," for more details.")),(0,i.kt)("h2",{id:"supported-authentication-flows"},"Supported Authentication Flows"),(0,i.kt)("p",null,"The SAP Cloud SDK does not implement most of the authentication flows itself.\nInstead, it relies on the Destination Service to perform the flows and complements it with additional steps, if necessary."),(0,i.kt)("p",null,"The SAP Cloud SDK recognizes the following authentication types of the SAP BTP Destination Service:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"Authentication Type"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Parameter Name"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/4e13a04147314e8e9e54321f25d93fdc.html"},(0,i.kt)("inlineCode",{parentName:"a"},"NoAuthentication"))),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"AuthenticationType.NO_AUTHENTICATION"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/4e13a04147314e8e9e54321f25d93fdc.html"},(0,i.kt)("inlineCode",{parentName:"a"},"BasicAuthentication"))),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"AuthenticationType.BASIC_AUTHENTICATION"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/73194cc419894433994c5f0444b4c6a1.html"},(0,i.kt)("inlineCode",{parentName:"a"},"PrincipalPropogation"))),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"AuthenticationType.PRINCIPAL_PROPAGATION"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"https://help.sap.com/docs/CP_CONNECTIVITY/cca91383641e40ffbe03bdc78f00f681/8634e210446844d09ae9627b450822fd.html"},(0,i.kt)("inlineCode",{parentName:"a"},"OAuth2TechnicalUserPropagation"))),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"AuthenticationType.OAUTH2_TECHNICAL_USER_PROPAGATION"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/4e13a04147314e8e9e54321f25d93fdc.html"},(0,i.kt)("inlineCode",{parentName:"a"},"ClientCertificateAuthentication"))),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"AuthenticationType.CLIENT_CERTIFICATE_AUTHENTICATION"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/b865ed651e414196b39f8922db2122c7/Cloud/en-US/e022a5eebaec4dbbabef7f5d60e13dd4.html?q=AppToAppSSO"},(0,i.kt)("inlineCode",{parentName:"a"},"AppToAppSSO"))),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"AuthenticationType.APP_TO_APP_SSO"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/4e1d742a3d45472d83b411e141729795.html"},(0,i.kt)("inlineCode",{parentName:"a"},"OAuth2ClientCredentials"))),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"AuthenticationType.OAUTH2_CLIENT_CREDENTIALS"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/c69ea6aacd714ad2ae8ceb5fc3ceea56.html"},(0,i.kt)("inlineCode",{parentName:"a"},"OAuth2SAMLBearerAssertion"))),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"AuthenticationType.OAUTH2_SAML_BEARER_ASSERTION"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/e3c333f9de6245fca326993f2397c13a.html"},(0,i.kt)("inlineCode",{parentName:"a"},"OAuth2UserTokenExchange"))),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"AuthenticationType.OAUTH2_USER_TOKEN_EXCHANGE"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/283cd2d1c72147a18c69daf681650f07.html"},(0,i.kt)("inlineCode",{parentName:"a"},"OAuth2JWTBearer"))),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"AuthenticationType.OAUTH2_JWT_BEARER"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/ceb8c4fa61e6443190185696c6d0342d.html"},(0,i.kt)("inlineCode",{parentName:"a"},"SAPAssertionSSO"))),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"AuthenticationType.SAP_ASSERTION_SSO"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/2d168c76daa1406b8567eee447eb1b2f/Cloud/en-US/a9c2c896be574077b56a7b2e2790e86c.html?q=InternalSystemAuthentication"},(0,i.kt)("inlineCode",{parentName:"a"},"InternalSystemAuthentication"))),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"AuthenticationType.INTERNAL_SYSTEM_AUTHENTICATION"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/452357cdd82a4c0ba6095b36c0057526.html"},(0,i.kt)("inlineCode",{parentName:"a"},"OAuth2Password"))),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"AuthenticationType.OAUTH2_PASSWORD"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/d81e1683bd434823abf3ceefc4ff157f.html"},(0,i.kt)("inlineCode",{parentName:"a"},"SAMLAssertion"))),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"AuthenticationType.SAML_ASSERTION"))))),(0,i.kt)("admonition",{title:"Other Destination Sources",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"In some situations you may want to obtain a destination ",(0,i.kt)("strong",{parentName:"p"},"not")," from the Destination Service, but e.g. from the environment variables."),(0,i.kt)("p",{parentName:"admonition"},"In that case, only ",(0,i.kt)("inlineCode",{parentName:"p"},"NoAuthentication")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"BasicAuthentication")," are supported by default.\nAdditionally, ",(0,i.kt)("inlineCode",{parentName:"p"},"OAuth2ClientCredentials")," as well as ",(0,i.kt)("inlineCode",{parentName:"p"},"OAuth2UserTokenExchange")," are available through a dedicated API."),(0,i.kt)("p",{parentName:"admonition"},"For more details visit the sections on how to ",(0,i.kt)("a",{parentName:"p",href:"#configure-http-destinations-for-local-development-environment"},"Configure HTTP Destinations for Local Deployment")," and ",(0,i.kt)("a",{parentName:"p",href:"#skip-destination-creation-step-for-certain-authentication-types-on-cloud-foundry"},"Skip Destination Creation Step for Certain Authentication Types on Cloud Foundry"),".")),(0,i.kt)("h3",{id:"integrated-multi-tenancy"},"Integrated Multi-Tenancy"),(0,i.kt)("p",null,"By default, the ",(0,i.kt)("inlineCode",{parentName:"p"},"DestinationAccessor")," is tenant aware.\nIf a tenant is available, it will be used to access the destination service on behalf of that tenant.\nIf no destination is found in the tenant-specific destination service, the SAP Cloud SDK will try to get it using the service binding of the application."),(0,i.kt)("p",null,"This default retrieval strategy can be overridden by passing options to the destination loader as follows:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"DestinationAccessor.getLoader().tryGetDestination(destinationName, options);\n")),(0,i.kt)("p",null,"See the section on ",(0,i.kt)("a",{parentName:"p",href:"#building-destination-options"},"destination options")," below."),(0,i.kt)("h2",{id:"supported-proxy-types"},"Supported Proxy Types"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"Proxy Type"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Parameter Name"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/42a0e6b966924f2e902090bdf435e1b2.html"},(0,i.kt)("inlineCode",{parentName:"a"},"Internet"))),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"ProxyType.INTERNET"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/cca91383641e40ffbe03bdc78f00f681/Cloud/en-US/42a0e6b966924f2e902090bdf435e1b2.html"},(0,i.kt)("inlineCode",{parentName:"a"},"OnPremise"))),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"ProxyType.ON_PREMISE"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("a",{parentName:"td",href:"https://help.sap.com/viewer/product/PRIVATE_LINK/CLOUD/en-US"},(0,i.kt)("inlineCode",{parentName:"a"},"PrivateLink")),"*"),(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"ProxyType.PRIVATE_LINK"))))),(0,i.kt)("p",null,"*"," Further reading: ",(0,i.kt)("a",{parentName:"p",href:"https://blogs.sap.com/2021/10/28/btp-private-linky-swear-with-azure-propagate-your-sap-principels/"},"SAP BTP Private Link Announcement Blog Post")),(0,i.kt)("h2",{id:"decorating-destinations"},"Decorating Destinations"),(0,i.kt)("p",null,"Depending on the use case, one needs to wrap the accessed destination before issuing a request to a system.\nThis is to make sure all required destination properties are correctly set before invoking the actual request."),(0,i.kt)("h3",{id:"http-destinations"},"HTTP Destinations"),(0,i.kt)("p",null,"In case of HTTP connections one needs to wrap the retrieved destination as ",(0,i.kt)("inlineCode",{parentName:"p"},"HttpDestination")," using ",(0,i.kt)("inlineCode",{parentName:"p"},"asHttp()"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'DestinationAccessor.getDestination("my-destination").asHttp();\n')),(0,i.kt)("p",null,"This method ensures that the required destination properties are all set to make the HTTP connection.\nWith the resulting destination instance depending on the use case one can run HTTP queries for OData or REST."),(0,i.kt)("h3",{id:"bapi-destinations"},"BAPI Destinations"),(0,i.kt)("p",null,"Similarly, for BAPI endpoints you need to use ",(0,i.kt)("inlineCode",{parentName:"p"},"asRfc()"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'DestinationAccessor.getDestination("my-destination").asRfc();\n')),(0,i.kt)("h2",{id:"registering-destinations-at-runtime"},"Registering Destinations at Runtime"),(0,i.kt)("p",null,"The SAP Cloud SDK offers convenient ways to create a destination at runtime and register it so that it will be available via ",(0,i.kt)("inlineCode",{parentName:"p"},"DestinationAccessor.getDestination()"),".\nThis is especially useful when working in a local environment.\nDestinations configured in the destination service are not available in a local setting and have to be mocked."),(0,i.kt)("p",null,"You can create a destination manually and prepare a loader for it as follows:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'customHttpDestination = DefaultHttpDestination.builder("http://url")\n        .name("custom-destination")\n        .build();\n\ncustomLoader = new DefaultDestinationLoader()\n        .registerDestination(customHttpDestination);\n\nDestinationAccessor.appendDestinationLoader(loader);\n\n// This will now return the custom destination\nDestinationAccessor.getDestination("custom-destination").asHttp();\n')),(0,i.kt)("p",null,"By default, the ",(0,i.kt)("inlineCode",{parentName:"p"},"DestinationAccessor")," is using a ",(0,i.kt)("inlineCode",{parentName:"p"},"DestinationLoaderChain")," that comprises multiple loaders.\nThese are e.g. a loader to get destinations from the destination service and a loader that reads destinations from environment variables."),(0,i.kt)("p",null,"The above ",(0,i.kt)("inlineCode",{parentName:"p"},"appendDestinationLoader()")," will add the provided loader at the end of such a chain.\nThat means the new loader can operate as a fallback.\nUse ",(0,i.kt)("inlineCode",{parentName:"p"},"prependDestinationLoader()")," to add it at the beginning if you would like it to take precedence."),(0,i.kt)("p",null,"Lastly use ",(0,i.kt)("inlineCode",{parentName:"p"},"setLoader()")," to replace all existing loaders.\nThis is useful if you want to supply a single destination to a piece of test code."),(0,i.kt)("h3",{id:"enabling-mtls-for-application-to-destination-communication"},"Enabling mTLS for Application to Destination communication"),(0,i.kt)("p",null,"To enable mTLS while communicating with the target destination, configure the security configuration option while building up your destination at runtime."),(0,i.kt)("p",null,"There are two ways to specify where the HTTP Security Configuration like for e.g. the certificate, private key etc. for outbound HTTP calls is determined from."),(0,i.kt)("p",null,"You can choose between the options ",(0,i.kt)("inlineCode",{parentName:"p"},"SecurityConfigurationStrategy.FROM_PLATFORM")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"SecurityConfigurationStrategy.FROM_DESTINATION"),", which is the default."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'customHttpDestination = DefaultHttpDestination.builder("http://url")\n        .name("custom-destination")\n        .securityConfiguration(SecurityConfigurationStrategy.FROM_PLATFORM)\n        .build();\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"SecurityConfigurationStrategy.FROM_PLATFORM")," ensures that the security configuration is derived from the BTP CF ",(0,i.kt)("a",{parentName:"p",href:"https://docs.cloudfoundry.org/devguide/deploy-apps/instance-identity.html"},"Instance Identity"),"."),(0,i.kt)("p",null,"On the other hand ",(0,i.kt)("inlineCode",{parentName:"p"},"SecurityConfigurationStrategy.FROM_DESTINATION")," derives the security configuration from the destination properties."),(0,i.kt)("h2",{id:"provide-headers-for-destinations"},"Provide Headers for Destinations"),(0,i.kt)("h3",{id:"how-it-works"},"How It Works"),(0,i.kt)("p",null,"You can add headers that are sent for any request over destinations.\nYou can implement custom logic that defines which headers are sent under which circumstances."),(0,i.kt)("admonition",{title:"Example Use-case",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Let's imagine, you want to send an API token via a request header with any calls made over any destination in your whole application.")),(0,i.kt)("p",null,"The SAP Cloud SDK offers the interface ",(0,i.kt)("inlineCode",{parentName:"p"},"DestinationHeaderProvider")," which defines the method ",(0,i.kt)("inlineCode",{parentName:"p"},"List<Header> getHeaders(DestinationRequestContext)"),".\nAt runtime, while preparing an outbound request, the SAP Cloud SDK will use all implementations of that interface which have been registered via the Java ServiceLoader mechanism (see below).\nFor each registered implementation it invokes the method ",(0,i.kt)("inlineCode",{parentName:"p"},"getHeaders(DestinationRequestContext)")," and appends the returned headers to the currently prepared request."),(0,i.kt)("p",null,"You can also add headers to a specific destination using properties so they will be always included when calling the target system.\nSee the ",(0,i.kt)("a",{parentName:"p",href:"#add-headers-via-destination-properties"},"relevant")," section below."),(0,i.kt)("h3",{id:"implement-own-header-provider"},"Implement Own Header Provider"),(0,i.kt)("h4",{id:"implement-the-interface-destinationheaderprovider"},"Implement the Interface ",(0,i.kt)("inlineCode",{parentName:"h4"},"DestinationHeaderProvider")),(0,i.kt)("p",null,"To implement your custom destination header provider, you need to implement the interface ",(0,i.kt)("inlineCode",{parentName:"p"},"DestinationHeaderProvider"),".\nThe method ",(0,i.kt)("inlineCode",{parentName:"p"},"getHeaders")," provides access to the request specific context.\nThe method argument of type ",(0,i.kt)("inlineCode",{parentName:"p"},"DestinationRequestContext")," lets you access the general properties over which the currently prepared request will be issued.\nDepending on your logic to determine headers, you can read the following data types:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"DestinationProperties getDestination()")," (e.g. the general destination name)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"URI getRequestUri()")," (e.g. the request specific query parameters)")),(0,i.kt)("p",null,"Here is one simple example implementation which returns the same header for each request:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'@Nonnull\n@Override\npublic List<Header> getHeaders( @Nonnull final DestinationRequestContext requestContext )\n{\n  final Header header = new Header("API-Token", obtainApiToken());\n\n  return Collections.singletonList(header);\n}\n')),(0,i.kt)("h4",{id:"make-interface-implementation-accessible"},"Make Interface Implementation Accessible"),(0,i.kt)("p",null,"The SAP Cloud SDK uses the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.oracle.com/javase/7/docs/api/java/util/ServiceLoader.html"},"Service Loader")," mechanism of Java to look up the ",(0,i.kt)("inlineCode",{parentName:"p"},"DestinationHeaderProvider")," implementations at runtime.\nTo let your custom implementation be found, you need to provide a configuration file as resource in the folder ",(0,i.kt)("inlineCode",{parentName:"p"},"META-INF/services"),".\nName this resource file as the interface ",(0,i.kt)("inlineCode",{parentName:"p"},"com.sap.cloud.sdk.cloudplatform.connectivity.DestinationHeaderProvider")," and mention the fully-qualified class name of your custom implementation.\nYou can refer to several implementations by putting their fully qualified class names on separate lines."),(0,i.kt)("p",null,"Place the new folder + file in your resources folder.\nIn a Maven project the resource folder is typically ",(0,i.kt)("inlineCode",{parentName:"p"},"src/main/resources/"),".\nFor example, if your custom implementation is named ",(0,i.kt)("inlineCode",{parentName:"p"},"ApiTokenHeaderProvider")," in the package ",(0,i.kt)("inlineCode",{parentName:"p"},"com.example"),", the configuration should be as follows:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"File path & name:",(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre"},"src/main/resources/META-INF/services/com.sap.cloud.sdk.cloudplatform.connectivity.DestinationHeaderProvider\n"))),(0,i.kt)("li",{parentName:"ul"},"File content:",(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre"},"com.example.ApiTokenHeaderProvider\n")))),(0,i.kt)("h3",{id:"add-headers-via-destination-properties"},"Add Headers via Destination Properties"),(0,i.kt)("p",null,'Here is one example implementation which adds the ("key1", "value1") header to every call to the destination:'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'destination =\n            DefaultHttpDestination\n                .builder(server.baseUrl())\n                .property("URL.headers.key1", "value1")\n                .build();\n')),(0,i.kt)("p",null,"To include headers into every call to a target system you can define them as properties on the destination.\nIt can be a destination object that you defined in the Cloud Foundry Cockpit, or one you built in code via a destination builder.\nFor that, call the ",(0,i.kt)("inlineCode",{parentName:"p"},".property()")," method on the destination.\nIt expects a key-value pair with a key formatted as ",(0,i.kt)("inlineCode",{parentName:"p"},"URL.headers.<key>")," and an arbitrary value string."),(0,i.kt)("admonition",{title:"SAP Language Header",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"When communicating with an S/4HANA (Cloud) system one can send a header to request a language preference.\nThis can be done by setting the ",(0,i.kt)("inlineCode",{parentName:"p"},"sap-language")," property on the destination.\nThe value of this property should be a valid language tag as defined in ",(0,i.kt)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc5646"},"RFC 5646"),"."),(0,i.kt)("p",{parentName:"admonition"},"Alternatively, the SAP Cloud SDK can also dynamically send the ",(0,i.kt)("inlineCode",{parentName:"p"},"sap-language")," header based on the current locale of an incoming request or the system locale.\nTo achieve this, set a ",(0,i.kt)("inlineCode",{parentName:"p"},"cloudsdk.dynamicSapLanguage")," property to ",(0,i.kt)("inlineCode",{parentName:"p"},"true")," on the destination.")),(0,i.kt)("h2",{id:"provide-query-parameters-for-destinations"},"Provide Query Parameters for Destinations"),(0,i.kt)("h3",{id:"how-it-works-1"},"How It Works"),(0,i.kt)("p",null,"You can add query parameters to a specific destination using properties.\nThey will always be included in the query string when calling the target system."),(0,i.kt)("h3",{id:"add-query-parameters-via-destination-properties"},"Add Query Parameters via Destination Properties"),(0,i.kt)("p",null,'Here is one simple example implementation which adds "key1=value1" to the query string when calling the destination:'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'destination =\n            DefaultHttpDestination\n                .builder(server.baseUrl())\n                .property("URL.queries.key1", "value1")\n                .build();\n')),(0,i.kt)("p",null,"To include query parameters in the query string when calling to a target system you can define them as properties on the destination.\nFor that, call the ",(0,i.kt)("inlineCode",{parentName:"p"},".property()")," method on the destination.\nIt expects a key-value pair with a key formatted as ",(0,i.kt)("inlineCode",{parentName:"p"},"URL.headers.<key>")," and an arbitrary value string."),(0,i.kt)("h2",{id:"retrieving-destinations"},"Retrieving Destinations"),(0,i.kt)("h3",{id:"get-all-destinations-from-the-destination-service-on-cloud-foundry"},"Get All Destinations From the Destination Service on Cloud Foundry"),(0,i.kt)("p",null,"To fetch all destinations from the Destination Service, you need to make a call to ",(0,i.kt)("inlineCode",{parentName:"p"},"tryGetAllDestinations"),".\nThe method queries the ",(0,i.kt)("a",{parentName:"p",href:"https://api.sap.com/api/SAP_CP_CF_Connectivity_Destination/overview"},"Destination Service API")," and retrieves all the destinations available at the service instance and sub-account level.\nIn case there is a destination available on both the levels with the same name, then this method prioritizes the destination at the service instance level."),(0,i.kt)("p",null,"Below is the sample call to ",(0,i.kt)("inlineCode",{parentName:"p"},"tryGetAllDestinations"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"Try<Iterable<ScpCfDestination>> destinations = destinationLoader.tryGetAllDestinations(options);\n")),(0,i.kt)("p",null,"In the above call ",(0,i.kt)("inlineCode",{parentName:"p"},"destinationLoader")," needs to be an instance of ",(0,i.kt)("inlineCode",{parentName:"p"},"ScpCfDestinationLoader"),"."),(0,i.kt)("h4",{id:"configuring-timeout-durations-when-querying-the-destination-service-on-cloud-foundry"},"Configuring Timeout Durations When Querying the Destination Service on Cloud Foundry"),(0,i.kt)("p",null,"By default, the ",(0,i.kt)("a",{parentName:"p",href:"/cloud-sdk/docs/java/features/resilience#resilience-capabilities"},(0,i.kt)("inlineCode",{parentName:"a"},"TimeLimiter")," resilience pattern")," aborts requests to the Destination Service on Cloud Foundry after 6 seconds.\nIf your app requires more time when fetching destinations, you may create your own ",(0,i.kt)("inlineCode",{parentName:"p"},"ScpCfDestinationLoader")," instance by:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"// Allow requests to take up to 10 seconds instead of just 6\nDestinationLoader destinationLoader = ScpCfDestinationLoader.builder()\n            .withTimeLimiterConfiguration(ResilienceConfiguration.TimeLimiterConfiguration.of(Duration.ofSeconds(10)))\n            .build();\n")),(0,i.kt)("p",null,"To disable the timeout entirely, use ",(0,i.kt)("inlineCode",{parentName:"p"},"TimeLimiterConfiguration.disabled()"),"."),(0,i.kt)("admonition",{title:"Hint",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"You may register your ",(0,i.kt)("inlineCode",{parentName:"p"},"destinationLoader")," within the ",(0,i.kt)("inlineCode",{parentName:"p"},"DestinationAccessor")," by:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-java"},"DestinationAccessor.setLoader(destinationLoader);\n")),(0,i.kt)("p",{parentName:"admonition"},"That way, all future requests to the Destination Service will use the increased timeout duration.")),(0,i.kt)("h4",{id:"configuring-caching-when-querying-the-destination-service-on-cloud-foundry"},"Configuring Caching When Querying the Destination Service on Cloud Foundry"),(0,i.kt)("admonition",{title:"Cached Destinations respects AuthToken Validity",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Although ",(0,i.kt)("inlineCode",{parentName:"p"},"DestinationAccessor")," uses a cache to minimize the overhead of fetching destinations, it still respects the validity of the associated AuthToken(if applicable for the destination).\nIf a cached destination's AuthToken is invalid, the SAP Cloud SDK will automatically fetch the destination again from the Destination Service and cache the results as long as ",(0,i.kt)("inlineCode",{parentName:"p"},"DestinationAccessor")," API is used to fetch destinations.")),(0,i.kt)("p",null,"The SAP Cloud SDK, by default, caches up to 1,000 destinations retrieved from the Destination Service on Cloud Foundry for a maximum of 5 minutes.\nThis behavior has two implications:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Application performance can be (drastically) improved by serving already known destinations from the cache instead of querying the Destination Service over and over again."),(0,i.kt)("li",{parentName:"ol"},"Changes to destinations, for example, via the SAP BTP Cockpit, may take a while until they are reflected in the application.")),(0,i.kt)("p",null,"Depending on the use-case, the default cache configuration might be suboptimal.\nTherefore, the SAP Cloud SDK offers an API for adjusting the caching behavior at application runtime."),(0,i.kt)("p",null,"The example below changes the cache to store more entries for a longer period of time."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"ScpCfDestinationLoader.Cache.setSizeLimit(10_000L);\nScpCfDestinationLoader.Cache.setExpiration(Duration.ofHours(2L), CacheExpirationStrategy.WHEN_CREATED);\n")),(0,i.kt)("admonition",{title:"Cache Size",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Please note that the size limit does not apply to the cache for ",(0,i.kt)("inlineCode",{parentName:"p"},"ScpCfDestinationLoader.tryGetAllDestinations()"),".")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Change Detection Mode")),(0,i.kt)("p",null,"In case your application typically interacts with more than one destination per tenant you can significantly improve performace by enabling ",(0,i.kt)("strong",{parentName:"p"},"change detection"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"ScpCfDestinationLoader.Cache.enableChangeDetection();\n")),(0,i.kt)("p",null,"This mode will ensure the current cache entries are still valid using a single request (per tenant), instead of checking for each destination individually.\nFor a single destination this is not a benefit, but for two or more the benefit is up to 100% per additional destination.\nFor example, if you are interacting with 5 destinations per tenant, you can expect a 3 to 4 times performance increase."),(0,i.kt)("admonition",{title:"Change Detection Interval",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"When using change detection, the cache expiration duration configured becomes the change detection interval.\nAs described above, this determines how quickly changes to a destination in the BTP cockpit are reflected in your application.\nFor example, the default setting of 5 minutes ensures, that when changing a destination it will take no more than 5 minutes for the cache to detect the change.")),(0,i.kt)("p",null,"In rare circumstances, it might make sense to disable either specific aspects of the caching behavior, or even the entire cache.\nFor those scenarios, following APIs are available:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"// cache can store an infinite amount of entries\nScpCfDestinationLoader.Cache.disableSizeLimit();\n\n// cache entries never expire\n// note: this setting is not available when the change detection mode is enabled\nScpCfDestinationLoader.Cache.disableExpiration();\n\n// or don't cache destinations at all\nScpCfDestinationLoader.Cache.disable();\n")),(0,i.kt)("admonition",{title:"Shared Cache Size",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"The size limit is applied across all tenants (and principals in certain cases).\nOne tenant (with a lot of principals) might fill up the entire cache, if all destinations requested require user propagation.\nIf the requested destination doesn't require user propagation, destinations are cached per tenant instead."),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Example"),(0,i.kt)("p",{parentName:"admonition"},"If a thousand principals of the same tenant all query a single destination requiring user propagation, the cache will be entirely filled up with destinations belonging to the same tenant."),(0,i.kt)("p",{parentName:"admonition"},"As a consequence, existing cache entries - also those of different tenants - must be removed (",(0,i.kt)("em",{parentName:"p"},"evicted"),") from the cache to make space for the new entries."))),(0,i.kt)("admonition",{title:"Hint",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Changing the cache configuration at runtime will lead to a recreation of the underlying cache.\nHereby, ",(0,i.kt)("strong",{parentName:"p"},"all existing")," cache entries will be lost."),(0,i.kt)("p",{parentName:"admonition"},"Therefore, we recommend adjusting the cache once at application startup.")),(0,i.kt)("admonition",{title:"Hint",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"For better performance, while querying for destinations ",(0,i.kt)("strong",{parentName:"p"},"with user propagation"),", users may provide the ",(0,i.kt)("inlineCode",{parentName:"p"},"EXCHANGE_ONLY")," token exchange strategy.\nRefer ",(0,i.kt)("a",{parentName:"p",href:"#token-exchange-options"},"here")," for more details.")),(0,i.kt)("h4",{id:"building-destination-options"},"Building Destination Options"),(0,i.kt)("p",null,"You need to build a ",(0,i.kt)("inlineCode",{parentName:"p"},"DestinationOptions")," object and pass it as a parameter.\nIt defines how Destinations Service is queried.\nIn a simple application without provider/subscriber setup, your initial configuration is as simple as:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"DestinationOptions options = DestinationOptions.builder().build();\n")),(0,i.kt)("h5",{id:"retrieval-strategy-options"},"Retrieval Strategy Options"),(0,i.kt)("p",null,"For a provider/subscriber setup, a ",(0,i.kt)("a",{parentName:"p",href:"https://help.sap.com/doc/b579bf8578954412aea2b458e8452201/1.0/en-US/com/sap/cloud/sdk/cloudplatform/connectivity/ScpCfDestinationRetrievalStrategy.html"},"retrieval strategy")," must be chosen according to your particular use case from:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"CURRENT_TENANT")," (default)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ALWAYS_PROVIDER")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ONLY_SUBSCRIBER")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"CURRENT_TENANT_THEN_PROVIDER")," ",(0,i.kt)("a",{parentName:"li",href:"../../release-notes#4130---april-28-2023"},"(deprecated)"))),(0,i.kt)("p",null,"Here is an example for ",(0,i.kt)("inlineCode",{parentName:"p"},"ONLY_SUBSCRIBER")," option:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"DestinationOptions options =\n    DestinationOptions\n        .builder()\n        .augmentBuilder(\n            ScpCfDestinationOptionsAugmenter\n                .augmenter()\n                .retrievalStrategy(ScpCfDestinationRetrievalStrategy.ONLY_SUBSCRIBER))\n        .build();\n")),(0,i.kt)("h5",{id:"token-exchange-options"},"Token Exchange Options"),(0,i.kt)("p",null,"Besides the retrieval strategy, the SAP Cloud SDK also offers a ",(0,i.kt)("a",{parentName:"p",href:"https://help.sap.com/doc/69f4a2d15d9b404fac06e968f0633d98/1.0/en-US/com/sap/cloud/sdk/cloudplatform/connectivity/ScpCfDestinationTokenExchangeStrategy.html"},"token exchange strategy")," that lets you change the behavior when authentication requires a user token exchange.\nThere are four different options available:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"FORWARD_USER_TOKEN")," (default)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"LOOKUP_THEN_EXCHANGE")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"LOOKUP_ONLY")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"EXCHANGE_ONLY"))),(0,i.kt)("p",null,"By default, the SAP Cloud SDK checks whether the current context contains an user access token originating from the XSUAA identity service.\nIf that's the case, then the token will be forwarded as part of the destination lookup queries.\nOtherwise, ",(0,i.kt)("inlineCode",{parentName:"p"},"LOOKUP_THEN_EXCHANGE")," will be applied:\nFirst SAP Cloud SDK looks up the destination on the destination service and evaluates the authentication type.\nIf the authentication type requires a user token exchange the SAP Cloud SDK immediately performs that exchange."),(0,i.kt)("p",null,'If you know that the destination you are about to retrieve requires a user token exchange you can improve performance by skipping the initial "look up" request like so:'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'DestinationOptions options =\n    DestinationOptions\n        .builder()\n        .augmentBuilder(\n            ScpCfDestinationOptionsAugmenter\n                .augmenter()\n                .tokenExchangeStrategy(ScpCfDestinationTokenExchangeStrategy.EXCHANGE_ONLY))\n        .build();\n\nTry<Destination> destination = DestinationAccessor.getLoader().tryGetDestination("MyDestination", options);\n')),(0,i.kt)("h2",{id:"accessing-destination-properties"},"Accessing Destination Properties"),(0,i.kt)("p",null,"To access destination properties in a type-safe manner, you can make use of the predefined property keys in the ",(0,i.kt)("inlineCode",{parentName:"p"},"DestinationProperty")," class,\nwhich is intended to be used similarly to an enum. Use of the ",(0,i.kt)("inlineCode",{parentName:"p"},"DestinationProperty")," keys avoids the need to provide your own String identifiers\nand expected type-casting for retrieving destination properties."),(0,i.kt)("p",null,"Here is an example of accessing the URI property of a destination:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"Destination destination;\nOption<String> uri =\n            destination.get(DestinationProperty.URI);\n")),(0,i.kt)("h2",{id:"configure-http-destinations-for-local-development-environment"},"Configure HTTP Destinations for Local Development Environment"),(0,i.kt)("p",null,"When testing your app on you local development machine instead of SAP BTP, you require some configuration steps to make the destination retrieval work."),(0,i.kt)("admonition",{title:"Relevant only for HTTP destinations",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Check our ",(0,i.kt)("a",{parentName:"p",href:"/cloud-sdk/docs/java/features/bapi-and-rfc/overview"},"BAPI and RFC documentation")," if you want to configure an RFC destination for local development.")),(0,i.kt)("p",null,"To better understand the configuration steps, we will shortly outline how destination retrieval works when your app runs on SAP BTP."),(0,i.kt)("h3",{id:"background-destination-retrieval-on-sap-business-technology-platform"},"Background: Destination Retrieval on SAP Business Technology Platform"),(0,i.kt)("p",null,"By default, the SAP Cloud SDK uses a set of destination loaders in the following order when searching for a destination via the ",(0,i.kt)("inlineCode",{parentName:"p"},"DestinationAccessor")," API"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Environment variable"),(0,i.kt)("li",{parentName:"ol"},"SAP BTP Destination service")),(0,i.kt)("p",null,"Example API call looks like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'\nDestinationAccessor.tryGetDestination("MyDestination");\n\n')),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Details and example values of a destination retrieval"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Lookup in the environment variable"),(0,i.kt)("p",{parentName:"li"},"The first destination loader attempts to find the requested destination in the environment variable ",(0,i.kt)("inlineCode",{parentName:"p"},"destinations"),".\nThis works the same in the local development environment.\nFor example:"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "type": "HTTP",\n    "name": "MyDestination",\n    "proxyType": "Internet",\n    "description": "This destination rocks!",\n    "authentication": "BasicAuthentication",\n    "url": "https://URL",\n    "user": "USER",\n    "password": "PASSWORD"\n  }\n]\n')),(0,i.kt)("p",null,"You can add as many destinations as you need this way."),(0,i.kt)("admonition",{title:"Authorization Token Forwarding",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"By adding ",(0,i.kt)("inlineCode",{parentName:"p"},'"forwardAuthToken": "true"')," to your destination, you will forward the value of the ",(0,i.kt)("inlineCode",{parentName:"p"},"Authorization")," header from the current request directly to the target system.")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Lookup via SAP BTP Destination service"),(0,i.kt)("p",{parentName:"li"},"If the previous lookup was not successful, the next destination loader examines the environment variable ",(0,i.kt)("inlineCode",{parentName:"p"},"VCAP_SERVICES")," to see if the SAP BTP Destination service is bound.\nThe SAP Cloud SDK tries to fetch the destination from the SAP BTP Destination service using the given destination name."))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Reaching On Premise Systems via the SAP BTP Connectivity Service")),"\nIn case the destination is of proxy type ",(0,i.kt)("inlineCode",{parentName:"p"},"OnPremise"),", the SAP Cloud SDK performs an additional query to the SAP BTP Connectivity service.\nFurther proxy information and an authorization token are obtained.")),(0,i.kt)("h3",{id:"automatically-inject-service-bindings-via-cloud-application-programming-development-kit"},"Automatically Inject Service bindings via Cloud Application Programming Development Kit"),(0,i.kt)("p",null,"If you already have a SAP BTP account with all the service binding and want to leverage them in you local environment - try ",(0,i.kt)("a",{parentName:"p",href:"https://cap.cloud.sap/docs/advanced/hybrid-testing#run-with-service-bindings"},"CAP Development Kit"),".\nThe SAP Cloud SDK will do the rest of the destination retrieval job for you as described above.\nYou will need ",(0,i.kt)("inlineCode",{parentName:"p"},"Node.js")," to ",(0,i.kt)("a",{parentName:"p",href:"https://cap.cloud.sap/docs/advanced/hybrid-testing#run-cap-java-apps-with-service-bindings"},"install CAP Development Kit")," by running:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"\nnpm i -g @sap/cds-dk\n\n")),(0,i.kt)("p",null,"Now, you can start any Java app with service binding injected into your local environment by using ",(0,i.kt)("inlineCode",{parentName:"p"},"cds bind")," command.\nThe command will create a ",(0,i.kt)("inlineCode",{parentName:"p"},"VCAP_SERVICES")," variable containing service keys from a Cloud Foundry space or Kubernetes cluster without storing credentials on a disk.\nStart your Java application similarly to the code snippet below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"\ncds bind --exec mvn spring-boot:run\n\n")),(0,i.kt)("p",null,"For more details look at the ",(0,i.kt)("a",{parentName:"p",href:"https://cap.cloud.sap/docs/advanced/hybrid-testing#run-with-service-bindings"},"official CAP documentation")),(0,i.kt)("h3",{id:"configure-destinations-manually"},"Configure Destinations Manually"),(0,i.kt)("h4",{id:"destinations-with-proxy-type-internet"},"Destinations With Proxy Type ",(0,i.kt)("inlineCode",{parentName:"h4"},"Internet")),(0,i.kt)("p",null,"Create the destination configuration and pass it via the environment variable ",(0,i.kt)("inlineCode",{parentName:"p"},"destinations"),".\nCheck the example below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "type": "HTTP",\n    "name": "MyDestination",\n    "proxyType": "Internet",\n    "description": "This destination rocks!",\n    "authentication": "BasicAuthentication",\n    "url": "https://URL",\n    "user": "USER",\n    "password": "PASSWORD"\n  }\n]\n')),(0,i.kt)("p",null,"You can add as many destinations as you need by adding them to the ",(0,i.kt)("inlineCode",{parentName:"p"},"JSON")," array."),(0,i.kt)("admonition",{title:"Authorization Token Forwarding",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"By adding ",(0,i.kt)("inlineCode",{parentName:"p"},'"forwardAuthToken": "true"')," to your destination, you will forward the value of the ",(0,i.kt)("inlineCode",{parentName:"p"},"Authorization")," header from the current request directly to the target system.")),(0,i.kt)("h4",{id:"destinations-with-proxy-type-onpremise"},"Destinations With Proxy Type ",(0,i.kt)("inlineCode",{parentName:"h4"},"OnPremise")),(0,i.kt)("p",null,"For this destination types we need to access the ",(0,i.kt)("strong",{parentName:"p"},"Destination")," and ",(0,i.kt)("strong",{parentName:"p"},"Connectivity")," services on SAP BTP.\nTo achieve that you have to bind them and inject via ",(0,i.kt)("a",{parentName:"p",href:"#automatically-inject-service-bindings-via-cap-development-kit"},"CAP Development Kit"),".\nOr manually provide your ",(0,i.kt)("a",{parentName:"p",href:"#create-and-provide-vcap_services-variable"},(0,i.kt)("inlineCode",{parentName:"a"},"VCAP_SERVIES"))," variable."),(0,i.kt)("admonition",{title:"When your Client and On-Premise Service are in the Same Network",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"If your local development environment and an On-Premise service are in the same network, you can use a simple HTTP destination by providing it via ",(0,i.kt)("inlineCode",{parentName:"p"},"destinations")," environment variable instead of relying on the SAP BTP Connectivity service.")),(0,i.kt)("h4",{id:"create-and-provide-vcap_services-variable"},"Create and Provide ",(0,i.kt)("inlineCode",{parentName:"h4"},"VCAP_SERVICES")," Variable"),(0,i.kt)("p",null,"How to create the ",(0,i.kt)("inlineCode",{parentName:"p"},"VCAP_SERVICES")," representation depends on whether the Cloud Application Programming (CAP) Model is used."),(0,i.kt)(o.Z,{groupId:"isCapUsed",defaultValue:"true",values:[{label:"CAP is used",value:"true"},{label:"CAP is not used",value:"false"}],mdxType:"Tabs"},(0,i.kt)(r.Z,{value:"false",mdxType:"TabItem"},(0,i.kt)("p",null,"Create the ",(0,i.kt)("inlineCode",{parentName:"p"},"VCAP_SERVIES")," environment variable on the shell or operating system level.\nCopy the value of that environment variable from your app which is deployed to SCP.")),(0,i.kt)(r.Z,{value:"true",mdxType:"TabItem"},(0,i.kt)("p",null,"Create the file ",(0,i.kt)("inlineCode",{parentName:"p"},"default-env.json")," in your project's root and supply the ",(0,i.kt)("inlineCode",{parentName:"p"},"VCAP_SERVICES")," value you copied beforehand so that the file looks similar to the following shortened example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "VCAP_SERVICES": {\n    "connectivity": [\n      {\n        "label": "connectivity",\n        "plan": "lite",\n        "name": "my-connectivity",\n        "instance_name": "my-connectivity",\n        "credentials": {\n          ...\n        }\n      }\n    ],\n    "xsuaa": [\n      {\n        "label": "xsuaa",\n        "plan": "space",\n        "name": "my-xsuaa",\n        "instance_name": "my-xsuaa",\n        "credentials": {\n          ...\n        }\n      }\n    ],\n    "destination": [\n      {\n        "label": "destination",\n        "plan": "lite",\n        "name": "my-destination",\n        "instance_name": "my-destination",\n        "credentials": {\n          ...\n        }\n      }\n    ]\n  }\n}\n\n\n')),(0,i.kt)("p",null,"Furthermore, add the dependency ",(0,i.kt)("inlineCode",{parentName:"p"},"com.sap.cds:cds-integration-cloud-sdk")," to your POM file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n  <groupId>com.sap.cds</groupId>\n  <artifactId>cds-integration-cloud-sdk</artifactId>\n</dependency>\n")))),(0,i.kt)("h4",{id:"reach-on-premise-service-from-the-sap-business-application-studio"},"Reach On-Premise Service from the SAP Business Application Studio"),(0,i.kt)("p",null,"If you are developing an application in the ",(0,i.kt)("strong",{parentName:"p"},"Business Application Studio (BAS)"),", and want to reach On-Premise systems, perform the following steps:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Make sure your BAS instance is part of the same CF space as your Cloud Connector."),(0,i.kt)("li",{parentName:"ol"},"Add properties ",(0,i.kt)("inlineCode",{parentName:"li"},"WebIDEEnabled")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"HTML5.DynamicDestination")," to your On-Premise destination with the value ",(0,i.kt)("inlineCode",{parentName:"li"},"true"),"."),(0,i.kt)("li",{parentName:"ol"},"In BAS, configure your ",(0,i.kt)("inlineCode",{parentName:"li"},"destinations")," environment variable as follows:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "type": "HTTP",\n    "name": "<DESTINATION-NAME>",\n    "url": "http://<DESTINATION-NAME>.dest",\n    "ProxyHost": "localhost",\n    "ProxyPort": 8887\n  }\n]\n')),(0,i.kt)("p",null,"Please refer to ",(0,i.kt)("a",{parentName:"p",href:"/docs/js/guides/bas"},"the BAS connectivity guide")," created for the SAP Cloud SDK for JavaScript to get more information and a detailed description of the technical background.\nThe information there also applies to the SAP Cloud SDK for Java."),(0,i.kt)("h4",{id:"skip-destination-creation-step-for-certain-authentication-types-on-cloud-foundry"},"Skip Destination Creation Step for Certain Authentication Types on Cloud Foundry"),(0,i.kt)("admonition",{title:"Deprecated API",type:"danger"},(0,i.kt)("p",{parentName:"admonition"},"The APIs mentioned below are ",(0,i.kt)("strong",{parentName:"p"},"deprecated")," and will be removed in version 5 of the SAP Cloud SDK, which is scheduled to be released in Q4 2023.")),(0,i.kt)("p",null,"For certain authentication types i.e. ",(0,i.kt)("inlineCode",{parentName:"p"},"NoAuthentication"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"OAuth2ClientCredentials")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"OAuth2UserTokenExchange")," there is an API that eliminates the need to manually create a destination in the CF account for connecting to services."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'final Map<String, String> mapping =\n      ScpCfServiceDestinationLoader.buildClientCredentialsMapping(\n        "credentials.endpoints.service_rest_url",\n        "credentials.uaa.clientid",\n        "credentials.uaa.clientsecret",\n        "credentials.endpoints.token_url");\n')),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"ScpCfServiceDestinationLoader.buildClientCredentialsMapping")," method creates a mapping for loading a destination and provides JSON paths for all required destination properties."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'final HttpDestination destination =\n      ScpCfServiceDestinationLoader.getDestinationForService(\n        "label",\n        "serviceBindingName",\n        AuthenticationType.OAUTH2_CLIENT_CREDENTIALS,\n        mapping);\n')),(0,i.kt)("p",null,"For certain services (only SAP BTP Workflow service for now), we provide further convenience that skips the need to provide the ",(0,i.kt)("inlineCode",{parentName:"p"},"mapping")," explicitly.\nExample:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'final HttpDestination destination =\n      ScpCfServiceDestinationLoader.getDestinationForService(\n        ScpCfServiceDestinationLoader.CfServices.WORKFLOW,\n        "my-workflow");\n')),(0,i.kt)("admonition",{title:"Caching",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"These destinations are currently not cached.\nPlease consider re-using the obtained destination objects when using ",(0,i.kt)("inlineCode",{parentName:"p"},"OAuth2ClientCredentials")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"OAuth2UserTokenExchange")," oo avoid unnecessary token retrievals.")),(0,i.kt)("h4",{id:"enable-access-to-sap-business-technology-platform-connectivity-service"},"Enable Access to SAP Business Technology Platform Connectivity Service"),(0,i.kt)("p",null,"The SAP BTP connectivity service builds the connection between SAP BTP and the On-premise network.\nThat is why it has strong built-in restrictions to allow it only to be called from within SCP.\nIf you call the connectivity service from your local machine, you will encounter a connection timeout.\nWe'll therefore apply port forwarding via SSH to simulate that your localhost plays the cloud app."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Deploy your app to the SAP BTP once."),(0,i.kt)("li",{parentName:"ul"},"Enable SSH access to your app container with the ",(0,i.kt)("inlineCode",{parentName:"li"},"cf")," CLI:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cf enable-ssh app-name\ncf restart app-name\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Inspect the value of the entry ",(0,i.kt)("inlineCode",{parentName:"li"},"connectivity")," of your ",(0,i.kt)("inlineCode",{parentName:"li"},"VCAP_SERVICES")," and take note of the values of the fields",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"credentials.onpremise_proxy_port")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"credentials.onpremise_proxy_host"))))),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"We'll refer to these values as ",(0,i.kt)("em",{parentName:"p"},"proxy-port")," and ",(0,i.kt)("em",{parentName:"p"},"proxy-host")," hereafter.")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Create an SSH session to your app container with the following command and let the session opened:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cf ssh app-name -L proxy-port:proxy-host:proxy-port\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Replace the value of the field ",(0,i.kt)("inlineCode",{parentName:"li"},"VCAP_SERVICES.connectivity.credentials.onpremise_proxy_host")," in your ",(0,i.kt)("inlineCode",{parentName:"li"},"default-env.json"),"\nwith ",(0,i.kt)("inlineCode",{parentName:"li"},"localhost"),".")),(0,i.kt)("admonition",{title:"Ready",type:"success"},(0,i.kt)("p",{parentName:"admonition"},"Now your local setup is ready to consume an On-premise HTTP destination.")))}m.isMDXComponent=!0},85162:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(67294),i=n(34334);const o="tabItem_Ymn6";function r(e){let{children:t,hidden:n,className:r}=e;return a.createElement("div",{role:"tabpanel",className:(0,i.Z)(o,r),hidden:n},t)}},74866:(e,t,n)=>{n.d(t,{Z:()=>C});var a=n(87462),i=n(67294),o=n(34334),r=n(12466),s=n(76775),l=n(91980),d=n(67392),p=n(50012);function c(e){return function(e){var t;return(null==(t=i.Children.map(e,(e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})))?void 0:t.filter(Boolean))??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:i}}=e;return{value:t,label:n,attributes:a,default:i}}))}function u(e){const{values:t,children:n}=e;return(0,i.useMemo)((()=>{const e=t??c(n);return function(e){const t=(0,d.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:n}=e;const a=(0,s.k6)(),o=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l._X)(o),(0,i.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(a.location.search);t.set(o,e),a.replace({...a.location,search:t.toString()})}),[o,a])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,o=u(e),[r,s]=(0,i.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:o}))),[l,d]=h({queryString:n,groupId:a}),[c,f]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,o]=(0,p.Nk)(n);return[a,(0,i.useCallback)((e=>{n&&o.set(e)}),[n,o])]}({groupId:a}),k=(()=>{const e=l??c;return m({value:e,tabValues:o})?e:null})();(0,i.useLayoutEffect)((()=>{k&&s(k)}),[k]);return{selectedValue:r,selectValue:(0,i.useCallback)((e=>{if(!m({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);s(e),d(e),f(e)}),[d,f,o]),tabValues:o}}var k=n(72389);const v="tabList__CuJ",y="tabItem_LNqP";function g(e){let{className:t,block:n,selectedValue:s,selectValue:l,tabValues:d}=e;const p=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.o5)(),u=e=>{const t=e.currentTarget,n=p.indexOf(t),a=d[n].value;a!==s&&(c(t),l(a))},m=e=>{var t;let n=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const t=p.indexOf(e.currentTarget)+1;n=p[t]??p[0];break}case"ArrowLeft":{const t=p.indexOf(e.currentTarget)-1;n=p[t]??p[p.length-1];break}}null==(t=n)||t.focus()};return i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},t)},d.map((e=>{let{value:t,label:n,attributes:r}=e;return i.createElement("li",(0,a.Z)({role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,key:t,ref:e=>p.push(e),onKeyDown:m,onClick:u},r,{className:(0,o.Z)("tabs__item",y,null==r?void 0:r.className,{"tabs__item--active":s===t})}),n??t)})))}function N(e){let{lazy:t,children:n,selectedValue:a}=e;const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===a));return e?(0,i.cloneElement)(e,{className:"margin-top--md"}):null}return i.createElement("div",{className:"margin-top--md"},o.map(((e,t)=>(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function b(e){const t=f(e);return i.createElement("div",{className:(0,o.Z)("tabs-container",v)},i.createElement(g,(0,a.Z)({},e,t)),i.createElement(N,(0,a.Z)({},e,t)))}function C(e){const t=(0,k.Z)();return i.createElement(b,(0,a.Z)({key:String(t)},e))}}}]);