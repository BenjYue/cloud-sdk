"use strict";(self.webpackChunksap_cloud_sdk_documentation=self.webpackChunksap_cloud_sdk_documentation||[]).push([[9299],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),c=u(n),m=i,h=c["".concat(l,".").concat(m)]||c[m]||p[m]||r;return n?a.createElement(h,s(s({ref:t},d),{},{components:n})):a.createElement(h,s({ref:t},d))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,s=new Array(r);s[0]=c;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:i,s[1]=o;for(var u=2;u<r;u++)s[u]=n[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},50196:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>f,frontMatter:()=>u,metadata:()=>p,toc:()=>m});var a=n(87462),i=(n(67294),n(3905)),r=n(74866),s=n(85162),o=n(44996),l=n(49819);const u={id:"v4-vdm-client",title:"Use the OData v4 Type-safe Client API",hide_title:!1,hide_table_of_contents:!1,sidebar_label:"OData v4 Client API",description:"Use SAP Cloud SDK for Java to build and run OData v4 requests in a type-safe way.",keywords:["sap","cloud","sdk","odata","java","VDM","generate"]},d=void 0,p={unversionedId:"features/odata/v4-vdm-client",id:"features/odata/v4-vdm-client",title:"Use the OData v4 Type-safe Client API",description:"Use SAP Cloud SDK for Java to build and run OData v4 requests in a type-safe way.",source:"@site/docs-java/features/odata/v4-client.mdx",sourceDirName:"features/odata",slug:"/features/odata/v4-vdm-client",permalink:"/cloud-sdk/docs/java/features/odata/v4-vdm-client",draft:!1,editUrl:"https://github.com/SAP/cloud-sdk/edit/main/docs-java/features/odata/v4-client.mdx",tags:[],version:"current",frontMatter:{id:"v4-vdm-client",title:"Use the OData v4 Type-safe Client API",hide_title:!1,hide_table_of_contents:!1,sidebar_label:"OData v4 Client API",description:"Use SAP Cloud SDK for Java to build and run OData v4 requests in a type-safe way.",keywords:["sap","cloud","sdk","odata","java","VDM","generate"]},sidebar:"docsJavaSidebar",previous:{title:"OData v2 Client API",permalink:"/cloud-sdk/docs/java/features/odata/v2-vdm-client"},next:{title:"Generic OData Client",permalink:"/cloud-sdk/docs/java/features/odata/generic-untyped-odata-client"}},c={},m=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Build and Execute OData Requests With the Typed OData Client",id:"build-and-execute-odata-requests-with-the-typed-odata-client",level:2},{value:"Using the Fluent API",id:"using-the-fluent-api",level:2},{value:"OData Features",id:"odata-features",level:2},{value:"Basic CRUD Operations",id:"basic-crud-operations",level:3},{value:"Handling of ETags",id:"handling-of-etags",level:4},{value:"Handling of Cross-Site Request Forgery Tokens",id:"handling-of-cross-site-request-forgery-tokens",level:3},{value:"Select",id:"select",level:3},{value:"Filter",id:"filter",level:3},{value:"Available Filter Expressions",id:"available-filter-expressions",level:4},{value:"Custom Filter Expressions",id:"custom-filter-expressions",level:4},{value:"OData Functions and Actions",id:"odata-functions-and-actions",level:3},{value:"Unbound Operations",id:"unbound-operations",level:4},{value:"Bound Operations",id:"bound-operations",level:4},{value:"Bound Operations on Collections",id:"bound-operations-on-collections",level:4},{value:"Composable Functions",id:"composable-functions",level:4},{value:"Accessing Extensible or Custom Fields",id:"accessing-extensible-or-custom-fields",level:3},{value:"Using Custom Fields In System Query Options",id:"using-custom-fields-in-system-query-options",level:4},{value:"Batch Requests",id:"batch-requests",level:3},{value:"Execute Batch Request",id:"execute-batch-request",level:4},{value:"Access Batch Response",id:"access-batch-response",level:4},{value:"Entity Update Strategies",id:"entity-update-strategies",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Navigation Properties",id:"navigation-properties",level:2},{value:"Server-Driven Paging",id:"server-driven-paging",level:2},{value:"Asynchronous OData API Calls",id:"asynchronous-odata-api-calls",level:2}],h={toc:m};function f(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"To leverage the type-safe OData v4 client, you need to add following dependencies to the ",(0,i.kt)("inlineCode",{parentName:"p"},"dependencies")," section of your ",(0,i.kt)("inlineCode",{parentName:"p"},"pom.xml"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>com.sap.cloud.sdk.datamodel</groupId>\n    <artifactId>odata-v4-core</artifactId>\n</dependency>\n<dependency>\n    <groupId>org.projectlombok</groupId>\n    <artifactId>lombok</artifactId>\n    <scope>provided</scope>\n</dependency>\n<dependency>\n    <groupId>javax.inject</groupId>\n    <artifactId>javax.inject</artifactId>\n    <scope>provided</scope>\n</dependency>\n<dependency>\n  <groupId>com.google.code.findbugs</groupId>\n  <artifactId>jsr305</artifactId>\n  <scope>provided</scope>\n</dependency>\n")),(0,i.kt)("p",null,"Furthermore, you need to have generated a client library for your OData service.\nSee the ",(0,i.kt)("a",{parentName:"p",href:"vdm-generator"},"generator documentation")," for how to generate such a client library."),(0,i.kt)("admonition",{title:"Discover services on the SAP Business Accelerator Hub",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"If you would like to consume a specific service, try searching for it on the ",(0,i.kt)("a",{parentName:"p",href:"https://api.sap.com/"},"SAP Business Accelerator Hub")," and visit an ",(0,i.kt)("strong",{parentName:"p"},"SAP Cloud SDK")," tab on the landing page of that service.\nThere you will find detailed instructions on how to use the SAP Cloud SDK to get a client library for that specific service.\nLearn more about the integration with the SAP Business Accelerator Hub in the ",(0,i.kt)("a",{parentName:"p",href:"https://blogs.sap.com/2021/09/17/the-sap-cloud-sdk-integrates-with-the-sap-api-business-hub/"},"blog"),".")),(0,i.kt)("h2",{id:"build-and-execute-odata-requests-with-the-typed-odata-client"},"Build and Execute OData Requests With the Typed OData Client"),(0,i.kt)("p",null,"The typed OData v4 client allows building type-safe OData v4 requests for a given service.\nThe Java classes represent the ",(0,i.kt)("em",{parentName:"p"},"data model")," and the available ",(0,i.kt)("em",{parentName:"p"},"operations")," of the service.\nAs a consequence, all requests that are built through the typed OData client are not only ",(0,i.kt)("em",{parentName:"p"},"syntactically valid")," but also ",(0,i.kt)("em",{parentName:"p"},"semantically valid"),"."),(0,i.kt)("admonition",{title:"Generic OData Client",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"The type-safe client may in some situations not be suitable for your needs.\nFor instance a service might not fully conform to the OData standard, forcing you to perform customized requests.\nOr the typed API doesn't support a specific OData feature just yet."),(0,i.kt)("p",{parentName:"admonition"},"For such cases we recommend leveraging our ",(0,i.kt)("a",{parentName:"p",href:"./generic-untyped-odata-client"},"low-level generic OData client"),".\nOr to fallback directly to the HTTP client level if that's not enough."),(0,i.kt)("p",{parentName:"admonition"},"In all the other situations the type-safe client is preferable and considered best practice.")),(0,i.kt)("h2",{id:"using-the-fluent-api"},"Using the Fluent API"),(0,i.kt)("p",null,"The typed OData v4 client consists of ",(0,i.kt)("em",{parentName:"p"},"service")," and ",(0,i.kt)("em",{parentName:"p"},"data model")," classes.\nThe service classes mirror the API provided by the OData service and serve as entry point for creating requests.\nThey provide a builder that allows for fluently adding further parameters."),(0,i.kt)("p",null,"To execute HTTP requests the OData client uses ",(0,i.kt)("em",{parentName:"p"},"Destinations")," and are documented in more detail ",(0,i.kt)("a",{href:(0,o.Z)("docs/java/features/connectivity/destination-service")},"here"),".\nThe following code snippets assume that such a destination is in place:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"HttpDestination destination;\n")),(0,i.kt)("p",null,"On an abstract level requests are generally build up according to the following pattern:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"result = service.operation()\n    .withParameter(...)\n    .execute(destination);\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"operation")," corresponds to the service's capabilities for entities e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"createEntity")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"readEntities"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"withParameter")," corresponds to:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"OData v4 query parameters e.g. ",(0,i.kt)("inlineCode",{parentName:"li"},"filter")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"orderby")),(0,i.kt)("li",{parentName:"ul"},"Or other modifiers like custom headers"))),(0,i.kt)("li",{parentName:"ul"},"Which OData v4 parameters are available depends on the operation.\nFor example, when updating entities the ",(0,i.kt)("inlineCode",{parentName:"li"},"$filter")," parameter is not available.")),(0,i.kt)("admonition",{title:"Business Partner Example",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Below, different OData features are documented using the ",(0,i.kt)("a",{parentName:"p",href:"https://api.sap.com/api/API_BUSINESS_PARTNER/resource"},"Business Partner Service")," on SAP S/4HANA as an example.\nThe service is represented by the ",(0,i.kt)("inlineCode",{parentName:"p"},"BusinessPartnerService")," class which you can obtain by ",(0,i.kt)("a",{parentName:"p",href:"vdm-generator"},"generating a client")," for the Business Partner service."),(0,i.kt)("p",{parentName:"admonition"},"The following code snippets assume that such a client is generated an instance of this service is set up:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-java"},"BusinessPartnerService service = new DefaultBusinessPartnerService();\n"))),(0,i.kt)("h2",{id:"odata-features"},"OData Features"),(0,i.kt)("h3",{id:"basic-crud-operations"},"Basic CRUD Operations"),(0,i.kt)("p",null,"Create, Read, Update and Delete operations on entities are build from the associated service class:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'service.createBusinessPartner(partner);\nservice.getBusinessPartnerByKey("id");\nservice.getAllBusinessPartner();\nservice.updateBusinessPartner(partner);\nservice.deleteBusinessPartnerAddress(address);\n')),(0,i.kt)("p",null,"Each of the above statements returns a builder object that allows for specifying certain request parameters, depending on the operation."),(0,i.kt)("p",null,"The following query parameters and request options are available for these operations:"),(0,i.kt)("p",null,"Query parameters:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$select"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"$expand")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"$search")," are available when reading a single value or multiple entities"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"$filter"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"$top"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"$skip")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"$orderby")," are available only when reading a collection of entities")),(0,i.kt)("p",null,"Request parameters:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Update operations allow to set either ",(0,i.kt)("inlineCode",{parentName:"li"},"modifyingEntity()")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"replacingEntity()")," which will result in ",(0,i.kt)("inlineCode",{parentName:"li"},"HTTP PATCH")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"HTTP PUT")," respectively.\nBy default, entities are modified via ",(0,i.kt)("inlineCode",{parentName:"li"},"PATCH"),"."),(0,i.kt)("li",{parentName:"ul"},"Update and delete operations allow modifying how ETags are handled:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"By default, an ETag is sent if one is present on the entity being modified."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"matchAnyVersionIdentifier()")," will instead always send a ",(0,i.kt)("inlineCode",{parentName:"li"},"*")," which acts as a wildcard to match all ETags."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ignoreAnyVersionIdentifier()")," will ensure that no ETag is sent."))),(0,i.kt)("li",{parentName:"ul"},"All operations allow for adding custom headers via ",(0,i.kt)("inlineCode",{parentName:"li"},"withHeader(...)"))),(0,i.kt)("h4",{id:"handling-of-etags"},"Handling of ETags"),(0,i.kt)("p",null,"An ",(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/ETag"},"ETag")," is a version identifier that is often used to implement an optimistic locking mechanism.\nThe SAP Cloud SDK will try to read version identifiers from responses and set them when sending OData requests."),(0,i.kt)("p",null,"Consider the following example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'partner = service.getBusinessPartnerByKey("id")\n                 .execute(destination);\nresponse = service.updateBusinessPartner(partner)\n                 .execute(destination);\n// update the partner reference\npartner = response.getModifiedEntity();\n')),(0,i.kt)("p",null,"On the read request, the SAP Cloud SDK will automatically try to extract the version identifier from the response and store it within the ",(0,i.kt)("inlineCode",{parentName:"p"},"partner")," object.\nWhen updating it will be taken from there and sent with the ",(0,i.kt)("inlineCode",{parentName:"p"},"If-match")," header."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"If a service requires this header to be sent: Fetching the entity from the service first is essential to ensure that the ETag is present and up to date.")),(0,i.kt)("h3",{id:"handling-of-cross-site-request-forgery-tokens"},"Handling of Cross-Site Request Forgery Tokens"),(0,i.kt)("p",null,"For create, update and delete requests the SAP Cloud SDK will try to send a ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Cross-site_request_forgery#Cookie-to-header_token"},"cross-site request forgery (CSRF) token"),".\nUpon execution, the request will try to fetch a token first before issuing the create request.\nMany services require this behavior for security reasons.\nHowever, the create request will be made without a CSRF token if none could be obtained."),(0,i.kt)("h3",{id:"select"},"Select"),(0,i.kt)("p",null,"When reading entities, the API offers ",(0,i.kt)("inlineCode",{parentName:"p"},"select( ... )")," on the builders.\nThrough it, the query parameters ",(0,i.kt)("inlineCode",{parentName:"p"},"$select")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"$expand")," are set.\nIt takes in the properties of the entity being queried.\nPrimitive properties are added to ",(0,i.kt)("inlineCode",{parentName:"p"},"$select")," while complex and navigational properties are added to ",(0,i.kt)("inlineCode",{parentName:"p"},"$expand"),".\nThis handling is done automatically by the SAP Cloud SDK."),(0,i.kt)("p",null,"The properties that can be selected or expanded are represented via static ",(0,i.kt)("em",{parentName:"p"},"fields on the entity")," class.\nThere will be a field for each property.\nE.g. for the business partner entity one can find ",(0,i.kt)("inlineCode",{parentName:"p"},"BusinessPartner.FIRST_NAME")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"BusinessPartner.LAST_NAME"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'service.getBusinessPartnerByKey("id")\n    .select(BusinessPartner.FIRST_NAME, BusinessPartner.LAST_NAME, BusinessPartner.TO_BUSINESS_PARTNER_ADDRESS)\n    .execute(destination);\n')),(0,i.kt)("p",null,"The above translates to the following query parameters:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$select=FirstName,LastName&$expand=to_BusinessPartnerAddress\n")),(0,i.kt)("p",null,"OData v4 allows for formulating nested, fully featured queries on complex and navigational properties.\nQuerying nested objects is possible within an expand statement.\nThat means the following query is possible:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'service.getBusinessPartnerByKey("id")\n    .select(BusinessPartner.TO_BUSINESS_PARTNER_ADDRESS\n        .select(BusinessPartnerAddress.CITY_CODE, BusinessPartnerAddress.COUNTRY)\n        .filter(BusinessPartnerAddress.CITY_CODE.notEqualTo("1234"))\n        .orderBy(BusinessPartnerAddress.COUNTRY.desc())\n    )\n    .execute(destination);\n')),(0,i.kt)("p",null,"The above translates to the following ",(0,i.kt)("inlineCode",{parentName:"p"},"expand")," query parameter:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$expand=to_BusinessPartnerAddress($select=CityCode,Country;$filter=CityCode eq '1234';$orderby=Country desc)\n")),(0,i.kt)("h3",{id:"filter"},"Filter"),(0,i.kt)("p",null,"When operating on a collection of entities, the API offers ",(0,i.kt)("inlineCode",{parentName:"p"},"filter( ... )")," on the builders.\nIt directly corresponds to the ",(0,i.kt)("inlineCode",{parentName:"p"},"$filter")," parameter of the request.\nFilters are also built via the static property fields on entities."),(0,i.kt)("p",null,"The following example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"/*\nGet all business partners that either:\n  - Have first name 'Alice' but not last name 'Bob'\n  - Or have first name 'Mallory'\n*/\nservice.getAllBusinessPartner()\n    .filter(BusinessPartner.FIRST_NAME.equalTo(\"Alice\")\n        .and(BusinessPartner.LAST_NAME.notEqualTo(\"Bob\"))\n        .or(BusinessPartner.FIRST_NAME.equalTo(\"Mallory\"))\n    )\n    .execute(destination);\n")),(0,i.kt)("p",null,"Will translate to this filter parameter:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$filter=(((FirstName eq 'Alice') and (LastName ne 'Bob')) or (FirstName eq 'Mallory'))\n")),(0,i.kt)("p",null,"Take note of the order of ",(0,i.kt)("inlineCode",{parentName:"p"},"and")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"or"),".\nAs ",(0,i.kt)("inlineCode",{parentName:"p"},"or")," is invoked on the result of ",(0,i.kt)("inlineCode",{parentName:"p"},"and")," it will form the outer expression while ",(0,i.kt)("inlineCode",{parentName:"p"},"and")," is an inner expression in the first branch of ",(0,i.kt)("inlineCode",{parentName:"p"},"or"),"."),(0,i.kt)("p",null,"To achieve a different order with ",(0,i.kt)("inlineCode",{parentName:"p"},"and")," as the top level statement one would nest the ",(0,i.kt)("inlineCode",{parentName:"p"},"or")," within ",(0,i.kt)("inlineCode",{parentName:"p"},"and(...)"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'.and(BusinessPartner.LAST_NAME.notEqualTo("Bob")\n    .or(BusinessPartner.FIRST_NAME.equalTo("Mallory"))\n)\n')),(0,i.kt)("h4",{id:"available-filter-expressions"},"Available Filter Expressions"),(0,i.kt)("p",null,"The ",(0,i.kt)("a",{parentName:"p",href:"http://docs.oasis-open.org/odata/odata/v4.01/odata-v4.01-part1-protocol.html#sec_SystemQueryOptionfilter"},"OData v4 standard")," allows for a wide range of filter expressions.\nA detailed list of what is available in the SAP Cloud SDK can be obtained from ",(0,i.kt)("a",{parentName:"p",href:"https://help.sap.com/doc/b579bf8578954412aea2b458e8452201/1.0/en-US/com/sap/cloud/sdk/datamodel/odatav4/expression/package-summary.html"},"the Javadoc"),".\nThe functionality can also be discovered through the fluent API."),(0,i.kt)("p",null,"The below example leverages OData v4 exclusive features to build a more complex request:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"/*\nFetch all business partners where:\n- the last name is at least twice as long as the first name\n- AND the combined string of first and last name does not contain 'bob'\n*/\nservice.getAllBusinessPartner()\n    .filter(BusinessPartner.FIRST_NAME.length().multiply(2).lessThan(BusinessPartner.LAST_NAME.length())\n        .and(BusinessPartner.FIRST_NAME.concat(BusinessPartner.LAST_NAME).contains(\"bob\"))\n    )\n    .execute(destination);\n")),(0,i.kt)("h4",{id:"custom-filter-expressions"},"Custom Filter Expressions"),(0,i.kt)("p",null,"The SAP Cloud SDK for Java also allows custom filter expressions.\nThis is useful when filter fields need to be passed dynamically."),(0,i.kt)("p",null,"For example, to filter based on ",(0,i.kt)("inlineCode",{parentName:"p"},"MiddleName")," use:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'ValueBoolean filterExpression = FieldReference.of("MiddleName").equalTo("SomeName");\nFilterableBoolean<BusinessPartner> customFilterExpression = FilterableBoolean.fromCustomFilter(filterExpression, BusinessPartner.class);\n\nservice.getAllBusinessPartner().filter(customFilterExpression).execute(destination);\n')),(0,i.kt)("h3",{id:"odata-functions-and-actions"},"OData Functions and Actions"),(0,i.kt)("p",null,"OData defines bound and unbound ",(0,i.kt)("a",{parentName:"p",href:"http://docs.oasis-open.org/odata/odata/v4.01/odata-v4.01-part1-protocol.html#sec_Operations"},"functions and actions"),"."),(0,i.kt)("h4",{id:"unbound-operations"},"Unbound Operations"),(0,i.kt)("p",null,"Unbound functions and actions can be performed via their respective methods on the service:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'service.myFunction("paramValue1", "paramValue2")\n      .execute(destination);\n')),(0,i.kt)("h4",{id:"bound-operations"},"Bound Operations"),(0,i.kt)("p",null,"Functions and actions bound to entity types can be invoked by navigating to any instance or collection of the entity type on the service."),(0,i.kt)("p",null,"For functions use ",(0,i.kt)("inlineCode",{parentName:"p"},"applyFunction"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"Entity myEntity;\nservice.forEntity(myEntity)\n      .applyFunction(Entity.myFunction())\n      .execute(destination);\n")),(0,i.kt)("p",null,"This will invoke the following HTTP call, assuming that ",(0,i.kt)("inlineCode",{parentName:"p"},"myEntity")," is identified by ",(0,i.kt)("inlineCode",{parentName:"p"},'"my-entity"'),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-txt"},"GET /service-root/Entity('my-entity')/MyNamespace.MyFunction()\n")),(0,i.kt)("p",null,"Similarly, for actions use ",(0,i.kt)("inlineCode",{parentName:"p"},"applyAction"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"Entity myEntity;\nservice.forEntity(myEntity)\n      .applyAction(Entity.myAction())\n      .execute(destination);\n")),(0,i.kt)("admonition",{title:"Obtaining an Entity to Operate on",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"To get an entity object to operate on it is generally recommended to download it from the service first via its respective ",(0,i.kt)("inlineCode",{parentName:"p"},"getByKey")," method.\nFetching an entity will also ensure that ETag is handled if OData Action is invoked, which often leads to a change of a state of an entity."),(0,i.kt)("p",{parentName:"admonition"},"Another way is to use a builder on an Entity object to create an instance if you are aware of the key properties that are required.")),(0,i.kt)("h4",{id:"bound-operations-on-collections"},"Bound Operations on Collections"),(0,i.kt)("p",null,"Functions and actions may also be bound to collections of entities.\nThey are also invoked via ",(0,i.kt)("inlineCode",{parentName:"p"},"applyFunction")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"applyAction")," but on the ",(0,i.kt)("inlineCode",{parentName:"p"},"service")," instance itself:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"service.applyAction(Entity.myAction())\n      .execute(destination);\n")),(0,i.kt)("p",null,"This will invoke the following HTTP call:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-txt"},"POST /service-root/Entity/MyNamespace.MyAction()\n")),(0,i.kt)("p",null,"Furthermore, OData allows invoking bound operations not only on entities but also on navigation properties.\nThe API allows you to navigate to any navigation property of an entity to invoke an operation:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"Entity myEntity;\nservice.forEntity(myEntity)\n      .navigateTo(Entity.NAVIGATION_PROPERTY)\n      .applyFunction(NavigationEntity.myFunction())\n      .execute(destination);\n")),(0,i.kt)("p",null,"This would yield:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-txt"},"GET /service-root/Entity('my-entity')/NavigationProperty/MyNamespace.MyFunction()\n")),(0,i.kt)("h4",{id:"composable-functions"},"Composable Functions"),(0,i.kt)("p",null,"Finally, functions may be composable.\nIf ",(0,i.kt)("inlineCode",{parentName:"p"},"IsComposable")," is set to ",(0,i.kt)("inlineCode",{parentName:"p"},"true")," in the service metadata the service allows to use the result of a function within another operation."),(0,i.kt)("p",null,"Consider the following request:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"GET /Entities('my-entity')/ComputeRelatedEntity()/EntityPropertyList?$top=5\n")),(0,i.kt)("p",null,"The service will first perform the function ",(0,i.kt)("inlineCode",{parentName:"p"},"ComputeRelatedEntity")," and then access the ",(0,i.kt)("inlineCode",{parentName:"p"},"EntityPropertyList")," property of the result entity.\nThen the top five elements are returned."),(0,i.kt)("p",null,"Such a request can be built with the API as follows:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"Entity myEntity;\nservice.forEntity(myEntity)\n      .withFunction(Entity.computeRelatedEntity())\n      .navigateTo(RelatedEntity.ENTITY_PROPERTY_LIST)\n      .getAll()\n      .top(5)\n      .execute(destination);\n")),(0,i.kt)("p",null,"For more details on the API see also the section about ",(0,i.kt)("a",{parentName:"p",href:"#navigation-properties"},"operating on navigation properties")," directly."),(0,i.kt)("h3",{id:"accessing-extensible-or-custom-fields"},"Accessing Extensible or Custom Fields"),(0,i.kt)("p",null,"The concept of ",(0,i.kt)("strong",{parentName:"p"},"In-app Extensibility")," allows users to introduce additional fields to an existing SAP S/4HANA service.\nTo consume and work with such custom fields in your application code, SAP Cloud SDK introduces the concept of custom fields."),(0,i.kt)("p",null,"You can set custom fields on an entity through the ",(0,i.kt)("inlineCode",{parentName:"p"},".setCustomField")," method and read the value in the entity using ",(0,i.kt)("inlineCode",{parentName:"p"},".getCustomField(fieldName)")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'businessPartner.setCustomField("shoeSize", 10);\n\nfinal int shoeSize = businessPartner.getCustomField("shoeSize");\n')),(0,i.kt)("p",null,"If you are unsure about the custom fields added by the customer, you can still use ",(0,i.kt)("inlineCode",{parentName:"p"},"getCustomFieldNames()")," to obtain the set of custom fields introduced.\nUse this set further on to pull values from the entity."),(0,i.kt)("p",null,"For e.g."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"final Set<String> customfieldNames = businessPartner.getCustomFieldNames();\n\nfor(String customFieldName: customfieldNames){\n    final Object customField = businessPartner.getCustomField(customFieldName);\n }\n")),(0,i.kt)("p",null,"The accessors for custom fields respect multitenancy.\n",(0,i.kt)("inlineCode",{parentName:"p"},"getCustomFieldNames()"),", for example, fetches only custom field names available in the context of the current tenant."),(0,i.kt)("h4",{id:"using-custom-fields-in-system-query-options"},"Using Custom Fields In System Query Options"),(0,i.kt)("p",null,"You can also pass custom fields to select or filter system query options:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'service.getAllBusinessPartner()\n         .select(new SimpleProperty.NumericInteger<>(BusinessPartner.class, "ShoeSize"))\n         .select(() -> "AnotherCustomField")\n         .filter(new SimpleProperty.NumericInteger<>(BusinessPartner.class, "ShoeSize").equalTo(42))\n         .execute(destination)\n')),(0,i.kt)("p",null,"Please be aware that such an example can work for all tenants only if ",(0,i.kt)("inlineCode",{parentName:"p"},"ShoeSize")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"AnotherCustomField")," are custom fields that have been defined by all tenants."),(0,i.kt)("h3",{id:"batch-requests"},"Batch Requests"),(0,i.kt)("p",null,"Batch requests allow wrapping multiple OData requests into one single batch call.\nThereby we reduce the number of round trips to the remote server.\nRefer to the ",(0,i.kt)("a",{parentName:"p",href:"http://docs.oasis-open.org/odata/odata/v4.0/os/part1-protocol/odata-v4.0-os-part1-protocol.html#_Toc372793748"},"official OData V4 spec")," for further reference about batch requests, their semantics, and the request/response format."),(0,i.kt)("h4",{id:"execute-batch-request"},"Execute Batch Request"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"service")," object offers the method ",(0,i.kt)("inlineCode",{parentName:"p"},"batch")," which allows access to the batch-related methods that help build the batch request."),(0,i.kt)("p",null,"Multiple single requests (like ",(0,i.kt)("inlineCode",{parentName:"p"},"createBusinessPartnerRequest"),") can be wrapped into so-called changesets.\nA changeset can be added by ",(0,i.kt)("inlineCode",{parentName:"p"},"addChangeset")," and the corresponding create, update, or delete operations can be passed as parameters into it.\nYou can wrap multiple changesets into one batch request.\nSimilarly, retrieve operations can be added to the batch request by using ",(0,i.kt)("inlineCode",{parentName:"p"},"addReadOperations"),"."),(0,i.kt)("p",null,"Use ",(0,i.kt)("inlineCode",{parentName:"p"},"execute")," to issue the batch request to the remote system.\nWe receive an instance of ",(0,i.kt)("inlineCode",{parentName:"p"},"BatchResponse")," as the result object."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"GetAllRequestBuilder<BusinessPartner> getBusinessPartners = service.getAllBusinessPartner();\nGetByKeyRequestBuilder<BusinessPartner> getBusinessPartnerByKey = ...\nCreateRequestBuilder<BusinessPartner> createBusinessPartnerRequest1 = ...\nCreateRequestBuilder<BusinessPartner> createBusinessPartnerRequest2 = ...\nDeleteRequestBuilder<BusinessPartner> deleteBusinessPartnerRequest = ...\n\nBatchResponse result =\n    service\n        .batch()\n        .addReadOperations(getBusinessPartners, getBusinessPartnerByKey)\n        .addChangeset(createBusinessPartnerRequest1, createBusinessPartnerRequest2, deleteBusinessPartnerRequest)\n        .execute(destination);\n")),(0,i.kt)("h4",{id:"access-batch-response"},"Access Batch Response"),(0,i.kt)("p",null,"Use ",(0,i.kt)("inlineCode",{parentName:"p"},"getModificationResult")," to access the response for a specific create, update, or delete operation."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"ModificationResponse<BusinessPartner> createResult = response.getModificationResult(createBusinessPartnerRequest1);\nModificationResponse<BusinessPartner> deleteResult = response.getModificationResult(deleteBusinessPartnerRequest);\n")),(0,i.kt)("p",null,"Similarly, use the method ",(0,i.kt)("inlineCode",{parentName:"p"},"getReadResult")," to access the response for a specific retrieve request."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"List<BusinessPartners> readAllResult = response.getReadResult(getBusinessPartners);\nBusinessPartner readByKeyResult = response.getReadResult(getBusinessPartnerByKey);\n")),(0,i.kt)("p",null,"Per the OData specification, either all operations or none within the same changeset are successful.\nHence, if the changeset was a failure then evaluating the result of the contained requests will contain the failure of the changeset."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"If all responses in a ",(0,i.kt)("inlineCode",{parentName:"p"},"BatchResponse")," are evaluated using ",(0,i.kt)("inlineCode",{parentName:"p"},"getReadResult(...)")," or/and ",(0,i.kt)("inlineCode",{parentName:"p"},"getModificationResult(...)"),", this ensures that the underlying ",(0,i.kt)("inlineCode",{parentName:"p"},"InputStream")," of the ",(0,i.kt)("inlineCode",{parentName:"p"},"HttpEntity")," is fully consumed\nand the HTTP connection is released back to the connection pool. If you do not evaluate all responses in a ",(0,i.kt)("inlineCode",{parentName:"p"},"BatchResponse")," consider using the ",(0,i.kt)("inlineCode",{parentName:"p"},"try-with-resources")," construct while executing batch requests.")),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"To ensure that all resources are properly closed while executing batch requests, we recommend using the ",(0,i.kt)("inlineCode",{parentName:"p"},"try-with-resources")," construct."),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-java"},"  try(\n      BatchResponse result = service.batch()\n                                    .addReadOperations(readOperation)\n                                    .addChangeSet(createRequest, updateRequest, deleteRequest)\n                                    .execute(destination)\n   ) {\n      List<BusinessPartner> entities = result.getReadResult(readOperation);\n      ModificationResponse<BusinessPartner> createResult = response.getModificationResult(createRequest);\n      ModificationResponse<BusinessPartner> deleteResult = response.getModificationResult(deleteRequest);\n  }\n")),(0,i.kt)("p",{parentName:"admonition"},"This is especially helpful in preventing connection leaks if you are re-using a ",(0,i.kt)("inlineCode",{parentName:"p"},"HttpClient")," to execute multiple batch requests.")),(0,i.kt)("h2",{id:"entity-update-strategies"},"Entity Update Strategies"),(0,i.kt)("p",null,"The SAP Cloud SDK supports different strategies for updating entities which differ in the HTTP method and the payload of the update request."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"To update an entity it should first be retrieved from the service.\nThis ensures the latest state of the entity is updated.\nOtherwise, updating with old data could erase changes that have been made to the entity in the meantime.\nMany services will enforce this behavior with optimistic locking mechanisms.\nRefer to the ",(0,i.kt)("a",{parentName:"p",href:"#handling-of-etags"},"section about ETags for details"),".")),(0,i.kt)(r.Z,{groupId:"updateStrategy",defaultValue:"modify",values:[{label:"Modify Entity (default)",value:"modify"},{label:"Replace Entity",value:"replace"}],mdxType:"Tabs"},(0,i.kt)(s.Z,{value:"modify",mdxType:"TabItem"},(0,i.kt)("p",null,"The default strategy is the ",(0,i.kt)("em",{parentName:"p"},"modifying entity update strategy")," which attempts to modify only the necessary entity fields in the remote system.\nIt issues a PATCH request and includes only the fields in the request payload whose values were ",(0,i.kt)("em",{parentName:"p"},"changed by its setter method"),".\nHence, fields whose values remain unchanged are not sent to the target system.\nCalling the method ",(0,i.kt)("inlineCode",{parentName:"p"},"includingFields(fields ...)")," instructs the SAP Cloud SDK to add the mentioned fields explicitly in the update request.\nYou could also add navigation properties to your request using the method.\nThis is useful for backend systems that require some unchanged fields in the request payload for given reasons."),(0,i.kt)("p",null,"This update strategy can be explicitly chosen by invoking the method ",(0,i.kt)("inlineCode",{parentName:"p"},"modifyingEntity()")," while building the update request."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"service.updateBusinessPartner(partner)\n    //method call optional, since active by default\n    .modifyingEntity()\n    //add the Business Partner full name and address explicitly to the update request\n    .includingFields(BusinessPartner.BUSINESS_PARTNER_FULL_NAME,BusinessPartner.TO_BUSINESS_PARTNER_ADDRESS)\n    .executeRequest(destination);\n")),(0,i.kt)("p",null,"To update a complex property use the following API"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'Entity entity;\nentity.setComplexProperty(new ComplexProperty("Foo"));\n')),(0,i.kt)("p",null,"Transitive changes inside a complex property will automatically be detected.")),(0,i.kt)(s.Z,{value:"replace",mdxType:"TabItem"},(0,i.kt)("p",null,"The ",(0,i.kt)("em",{parentName:"p"},"replacing entity update strategy")," attempts to replace the full entity in the remote system.\nIt issues a PUT request and submits all fields in the update request, regardless of any field changes."),(0,i.kt)("p",null,"This update strategy can be explicitly chosen by invoking the method ",(0,i.kt)("inlineCode",{parentName:"p"},"replacingEntity()")," while building the update request."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"service.updateBusinessPartner(partner)\n    .replacingEntity()\n    .executeRequest(destination);\n")),(0,i.kt)("p",null,"For excluding read-only fields or dependent properties that are not tied to key properties from your ",(0,i.kt)("inlineCode",{parentName:"p"},"PUT")," request payload, use ",(0,i.kt)("inlineCode",{parentName:"p"},"excludingFields()")," on your update request\nIt also allows you to exclude navigation properties from your request."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"service.updateBusinessPartner(partner)\n    .replacingEntity()\n    .excludingFields(BusinessPartner.BUSINESS_PARTNER_FULL_NAME,BusinessPartner.TO_BUSINESS_PARTNER_ADDRESS)\n    .executeRequest(destination);\n")))),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"It depends on the capabilities of the specific OData service in the remote system which update strategies are supported in an end-to-end scenario.\nFor example, there are cases where OData services do not support PUT requests.")),(0,i.kt)("h2",{id:"error-handling"},"Error Handling"),(0,i.kt)("p",null,"Sometimes requests fail and the SAP Cloud SDK provides a flexible way to deal with such failures on multiple levels.\nAll ",(0,i.kt)("inlineCode",{parentName:"p"},"execute")," methods may throw a runtime exception (extending) ",(0,i.kt)("inlineCode",{parentName:"p"},"ODataException"),".\nThis will always contain the request which was (attempted to be) sent out as well as the cause of the exception.\nTo handle all kind of failures consider the following code:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'try { ... }\n catch( final ODataException e ) {\n    ODataQueryGeneric query = e.getQuery();\n    logger.debug("The following query failed: {}", query);\n    // do something else\n}\n')),(0,i.kt)("p",null,"This handling is the most generic, handling all possible failures.\nFor more specific information, dedicated exceptions are inheriting from ",(0,i.kt)("inlineCode",{parentName:"p"},"ODataException"),".\nPlease check the ",(0,i.kt)("a",{parentName:"p",href:"https://help.sap.com/doc/b579bf8578954412aea2b458e8452201/1.0/en-US/com/sap/cloud/sdk/datamodel/odata/client/exception/ODataException.html"},"documentation")," for details on all the exception types."),(0,i.kt)("p",null,"To handle different kinds of failure one can list multiple catch clauses to cover different levels or cases that might occur, e.g.:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'try { ... }\ncatch( ODataServiceErrorException e ) {\n    // handle the specific error message from the response payload\n    ODataServiceError odataError = e.getODataError();\n    logger.debug("The OData service responded with an error: {}", odataError);\n} catch( ODataDeserializationException e ) {\n    // handle failures in deserialization\n} catch( ODataResponseException e ) {\n    // handle all other errors originating from handling the HTTP response\n    int httpCode = e.getHttpCode();\n    Collection<Header> httpCode = e.getHttpHeaders();\n    Option<String> httpBody = e.getHttpBody();\n}\n')),(0,i.kt)("p",null,"Note that instead of applying ",(0,i.kt)("inlineCode",{parentName:"p"},"try/catch")," one can also make use of ",(0,i.kt)("inlineCode",{parentName:"p"},"tryExecute")," on the request builders."),(0,i.kt)("h2",{id:"navigation-properties"},"Navigation Properties"),(0,i.kt)("p",null,"A navigation property describes a unidirectional relationship between two entity types.\nLike other properties, it has a name and declares a multiplicity, i.e. whether to expect a single value or multiple values.\nAdditionally, a navigation property allows for dedicated CRUD operations, that may not be exposed by default on entity sets of the service root.\nSuch operations also provide a convenient way to access the nested resources of entities."),(0,i.kt)("p",null,"The typed OData client for OData v4 supports the following operations on (arbitrarily nested) navigation properties:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Create"),(0,i.kt)("li",{parentName:"ul"},"Read"),(0,i.kt)("li",{parentName:"ul"},"Update"),(0,i.kt)("li",{parentName:"ul"},"Delete"),(0,i.kt)("li",{parentName:"ul"},"Count")),(0,i.kt)("p",null,"The below example leverages the creation of a nested entity in relation to an existing entity:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'/*\nCreate a new address for a specific business partner.\n*/\nBusinessPartner businessPartnerById = BusinessPartner.builder().businessPartner("123").build();\nBusinessPartnerAddress addressItem = BusinessPartnerAddress.builder().country("DE").build();\n\nservice.forEntity( businessPartnerById )\n    .navigateTo( BusinessPartner.TO_BUSINESS_PARTNER_ADDRESS )\n    .create( addressItem )\n    .execute( destination );\n')),(0,i.kt)("p",null,"This sample API call translates to the following service request:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'POST /ODataService/API_BUSINESS_PARTNER/A_BusinessPartner(123)/to_BusinessPartnerAddress\n{\n  "country": "de"\n}\n')),(0,i.kt)("h2",{id:"server-driven-paging"},"Server-Driven Paging"),(0,i.kt)("p",null,"Pagination describes the practice of splitting a collection of entities from reading requests into one or many pages.\nThe paging behavior is determined by both the server and the client."),(0,i.kt)("p",null,"OData service operators may decide to enable server-driven pagination to limit the amount of data that is fetched and sent over the network to the client, in case generic query options yield huge amounts of data.\nBy splitting the result-set into sequential pages of entities, the data can be requested incrementally.\nThis reduces initial network load and improves overall response times.\nIf the payload of an OData response contains a link including a ",(0,i.kt)("inlineCode",{parentName:"p"},"$skiptoken"),", then it indicates a next page to the result-set.\nThe iterable result-set is a consistent snapshot of the data, it can not change between reading individual pages."),(0,i.kt)("p",null,"In comparison, the OData consumer may use query options ",(0,i.kt)("inlineCode",{parentName:"p"},"$top")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"$skip")," (client-driven paging) to read partial data from the result-set, but relying on a consistent state while browsing through the data can be problematic.\nBetween individual requests, another user could delete or add an item.\nThis would result in an inconsistent aggregation of data."),(0,i.kt)("p",null,"By default, the SAP Cloud SDK automatically resolves all pages of a result-set if server-driven paging is encountered.\nFor the API consumer, it is not necessary to parse the next link and instantiate follow-up requests to aggregate the full result-set."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"List<BusinessPartner> iterablePagesOfEntities = service\n  .getAllBusinessPartner()\n  .execute( destination );\n")),(0,i.kt)("p",null,"In case memory efficiency and response time of the consuming application becomes a priority, then the advanced API provides additional means to manually iterate through the internal pages.\nWhile accessing the following methods, the internal HTTP requests are executed lazily:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"Iterable<List<BusinessPartner>> iterablePagesOfEntities = service\n  .getAllBusinessPartner()\n  .iteratingPages()\n  .execute( destination );\n\nIterable<BusinessPartner> iterableEntities = service\n  .getAllBusinessPartner()\n  .iteratingEntities()\n  .execute(destination);\n\nStream<BusinessPartner> streamingEntities = service\n  .getAllBusinessPartner()\n  .streamingEntities()\n  .execute(destination);\n")),(0,i.kt)("p",null,"The request builder allows for setting the optional parameter for preferred page size, e.g.:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},"Iterable<List<BusinessPartner>> iterablePagesOfEntities = service\n  .getAllBusinessPartner()\n  .withPreferredPageSize(20)\n  .iteratingPages()\n  .execute( destination );\n")),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Please note that the OData service is not obliged to respect this setting.")),(0,i.kt)("h2",{id:"asynchronous-odata-api-calls"},"Asynchronous OData API Calls"),(0,i.kt)(l.Z,{mdxType:"NotImplemented"}),(0,i.kt)("p",null,"The ",(0,i.kt)("a",{parentName:"p",href:"http://docs.oasis-open.org/odata/odata/v4.01/odata-v4.01-part1-protocol.html#sec_AsynchronousRequests"},"OData v4 standard ")," has introduced means for server-side asynchronous requests.\nThis feature is also supported in the ",(0,i.kt)("a",{parentName:"p",href:"https://help.sap.com/viewer/DRAFT/68bf513362174d54b58cddec28794093/202009.latest/en-US/b9c4dd6344694418b94c4bb3bdebfee1.html"},"SAP Gateway Foundation"),".\nAt the moment the SAP Cloud SDK for Java does not provide a typed API to make such requests.\nHowever, you can leverage our ",(0,i.kt)("a",{parentName:"p",href:"/cloud-sdk/docs/java/features/odata/generic-untyped-odata-client"},"Generic OData Client")," to simplify the logic of making such requests."),(0,i.kt)("admonition",{title:"Process Synchronous OData Request in Asynchronous Fashion on the client side",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"You can leverage ",(0,i.kt)("inlineCode",{parentName:"p"},"queueCallable")," from our ",(0,i.kt)("a",{parentName:"p",href:"/cloud-sdk/docs/java/features/resilience/#execution-variants"},"resilience API")," to run multiple OData requests in asynchronous & non-blocking way on the ",(0,i.kt)("strong",{parentName:"p"},"client side"),".")))}f.isMDXComponent=!0},85162:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(67294),i=n(34334);const r="tabItem_Ymn6";function s(e){let{children:t,hidden:n,className:s}=e;return a.createElement("div",{role:"tabpanel",className:(0,i.Z)(r,s),hidden:n},t)}},74866:(e,t,n)=>{n.d(t,{Z:()=>P});var a=n(87462),i=n(67294),r=n(34334),s=n(12466),o=n(76775),l=n(91980),u=n(67392),d=n(50012);function p(e){return function(e){var t;return(null==(t=i.Children.map(e,(e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})))?void 0:t.filter(Boolean))??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:i}}=e;return{value:t,label:n,attributes:a,default:i}}))}function c(e){const{values:t,children:n}=e;return(0,i.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:n}=e;const a=(0,o.k6)(),r=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l._X)(r),(0,i.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(a.location.search);t.set(r,e),a.replace({...a.location,search:t.toString()})}),[r,a])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,r=c(e),[s,o]=(0,i.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:r}))),[l,u]=h({queryString:n,groupId:a}),[p,f]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,r]=(0,d.Nk)(n);return[a,(0,i.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:a}),g=(()=>{const e=l??p;return m({value:e,tabValues:r})?e:null})();(0,i.useLayoutEffect)((()=>{g&&o(g)}),[g]);return{selectedValue:s,selectValue:(0,i.useCallback)((e=>{if(!m({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);o(e),u(e),f(e)}),[u,f,r]),tabValues:r}}var g=n(72389);const y="tabList__CuJ",k="tabItem_LNqP";function v(e){let{className:t,block:n,selectedValue:o,selectValue:l,tabValues:u}=e;const d=[],{blockElementScrollPositionUntilNextRender:p}=(0,s.o5)(),c=e=>{const t=e.currentTarget,n=d.indexOf(t),a=u[n].value;a!==o&&(p(t),l(a))},m=e=>{var t;let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=d.indexOf(e.currentTarget)+1;n=d[t]??d[0];break}case"ArrowLeft":{const t=d.indexOf(e.currentTarget)-1;n=d[t]??d[d.length-1];break}}null==(t=n)||t.focus()};return i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":n},t)},u.map((e=>{let{value:t,label:n,attributes:s}=e;return i.createElement("li",(0,a.Z)({role:"tab",tabIndex:o===t?0:-1,"aria-selected":o===t,key:t,ref:e=>d.push(e),onKeyDown:m,onClick:c},s,{className:(0,r.Z)("tabs__item",k,null==s?void 0:s.className,{"tabs__item--active":o===t})}),n??t)})))}function b(e){let{lazy:t,children:n,selectedValue:a}=e;const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=r.find((e=>e.props.value===a));return e?(0,i.cloneElement)(e,{className:"margin-top--md"}):null}return i.createElement("div",{className:"margin-top--md"},r.map(((e,t)=>(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function N(e){const t=f(e);return i.createElement("div",{className:(0,r.Z)("tabs-container",y)},i.createElement(v,(0,a.Z)({},e,t)),i.createElement(b,(0,a.Z)({},e,t)))}function P(e){const t=(0,g.Z)();return i.createElement(N,(0,a.Z)({key:String(t)},e))}},49819:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(67294);const i=()=>a.createElement("div",{className:"admonition admonition-info alert alert--info"},a.createElement("div",{className:"admonition-heading"},a.createElement("h5",null,a.createElement("span",{className:"admonition-icon"},a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},a.createElement("path",{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Not yet implemented")),a.createElement("div",{className:"admonition-content"},a.createElement("p",null,"Please,"," ",a.createElement("a",{href:"https://github.com/SAP/cloud-sdk/issues/new?assignees=&labels=feature+request&template=feature_request.md&title=",target:"_blank",rel:"noopener noreferrer"},"create a feature request")," ","if you interested in this feature.")))}}]);