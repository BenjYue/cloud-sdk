"use strict";(self.webpackChunksap_cloud_sdk_documentation=self.webpackChunksap_cloud_sdk_documentation||[]).push([[7339],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var o=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=o.createContext({}),u=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=u(e.components);return o.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(n),h=i,m=p["".concat(l,".").concat(h)]||p[h]||d[h]||a;return n?o.createElement(m,r(r({ref:t},c),{},{components:n})):o.createElement(m,r({ref:t},c))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,r=new Array(a);r[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var u=2;u<a;u++)r[u]=n[u];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}p.displayName="MDXCreateElement"},30738:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>u,toc:()=>d});var o=n(87462),i=(n(67294),n(3905)),a=n(44996),r=n(50941);const s={id:"troubleshooting-js",title:"Troubleshooting",hide_title:!1,hide_table_of_contents:!1,sidebar_label:"Troubleshooting",description:"Troubleshooting guide for the SAP Cloud SDK for JavaScript",keywords:["sap","cloud","sdk","cloud native","cloud sdk","sap cloud sdk","troubleshooting","connectivity"]},l=void 0,u={unversionedId:"troubleshooting-js",id:"troubleshooting-js",title:"Troubleshooting",description:"Troubleshooting guide for the SAP Cloud SDK for JavaScript",source:"@site/docs-js/troubleshooting.mdx",sourceDirName:".",slug:"/troubleshooting-js",permalink:"/cloud-sdk/docs/js/troubleshooting-js",draft:!1,editUrl:"https://github.com/SAP/cloud-sdk/edit/main/docs-js/troubleshooting.mdx",tags:[],version:"current",frontMatter:{id:"troubleshooting-js",title:"Troubleshooting",hide_title:!1,hide_table_of_contents:!1,sidebar_label:"Troubleshooting",description:"Troubleshooting guide for the SAP Cloud SDK for JavaScript",keywords:["sap","cloud","sdk","cloud native","cloud sdk","sap cloud sdk","troubleshooting","connectivity"]},sidebar:"docsJsSidebar",previous:{title:"Support",permalink:"/cloud-sdk/docs/js/support-js"}},c={},d=[{value:"Connectivity Issue",id:"connectivity-issue",level:2},{value:"Use Minimal Example",id:"use-minimal-example",level:3},{value:"Get Destination Error",id:"get-destination-error",level:3},{value:"Fix Cloud Issues",id:"fix-cloud-issues",level:3},{value:"Activate Backend Logs",id:"activate-backend-logs",level:3},{value:"Fix Connection Issues",id:"fix-connection-issues",level:3},{value:"Fix On-Premise Issues",id:"fix-on-premise-issues",level:3},{value:"Find Difference",id:"find-difference",level:3}],p={toc:d};function h(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"connectivity-issue"},"Connectivity Issue"),(0,i.kt)("p",null,"You are experiencing connectivity issues using the SAP Cloud SDK and the ",(0,i.kt)("a",{parentName:"p",href:"features/error-handling"},"error logs")," are not conclusive?\nIn such a case please follow the flowchart.\nFor each squared box, a dedicated section gives instructions below.\nThe circle indicate start and end points.\nA ",(0,i.kt)("inlineCode",{parentName:"p"},"get help")," circle means opening an issue on the respective component or repository."),(0,i.kt)(r.Z,{alt:"Troubleshooting connectivity",sources:{light:(0,a.Z)("img/trouble_shooting_light.svg"),dark:(0,a.Z)("img/trouble_shooting_dark.svg")},className:"center",width:"100%",mdxType:"ThemedImage"}),(0,i.kt)("h3",{id:"use-minimal-example"},"Use Minimal Example"),(0,i.kt)("p",null,"Often the issue is related to a framework that uses the SAP Cloud SDK and not the code itself.\nTherefore, add the minimal example to the code to ensure the error is related to the SAP Cloud SDK."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"import { executeHttpRequest } from '@sap-cloud-sdk/http-client';\nimport { getDestination } from '@sap-cloud-sdk/connectivity';\n\nasync function minimalTest() {\n  const destination = await getDestination({\n    destinationName: YOUR_DESTINATION_NAME\n  });\n  if (destination) {\n    destination.authTokens?.forEach(authToken => {\n      if (authToken.error) {\n        throw new Error(`Error in authToken ${authToken.error}`);\n      }\n    });\n  } else {\n    throw new Error('Destination is undefined.');\n  }\n  console.log('Destination Retrieved.');\n  const response = await executeHttpRequest(destination, {\n    method: 'get',\n    url: YOUR_SERVICE_URL\n  });\n  if (!response.data) {\n    throw new Error('No data returned');\n  }\n  console.log('Data Retrieved.');\n}\n")),(0,i.kt)("p",null,"Replace ",(0,i.kt)("em",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"em"},"YOUR_SERVICE_URL"))," with the URL of your service, e.g., ",(0,i.kt)("inlineCode",{parentName:"p"},"/sap/opu/odata/sap/API_BUSINESS_PARTNER/A_BusinessPartner?%24top=1"),".\nUse the same service you also plan to call in production to observe authorization issues in the test case as well.\nInclude all ",(0,i.kt)("inlineCode",{parentName:"p"},"getDestination()")," options you are using in your real example, like ",(0,i.kt)("inlineCode",{parentName:"p"},"useCache")," or ",(0,i.kt)("a",{parentName:"p",href:"./guides/how-to-retrieve-jwt"},"JWT"),".\nAlso adjust the example to your needs by adding additional log statements."),(0,i.kt)("p",null,"You can execute the minimal example locally to have a quicker turnaround time.\nThis is possible when you connect to a cloud system.\nTo do that, copy the ",(0,i.kt)("inlineCode",{parentName:"p"},"VCAP_SERVICES")," environment of the application to the local process."),(0,i.kt)("h3",{id:"get-destination-error"},"Get Destination Error"),(0,i.kt)("p",null,"You retrieved an error in the process of getting the destination or saw alarming logs while retrieving the destination.\nThis can have multiple reasons:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The destination name is not correct or the destination is not present in your SAP BTP account."),(0,i.kt)("li",{parentName:"ul"},"The destination has errors in the ",(0,i.kt)("inlineCode",{parentName:"li"},"authToken")," object.\nAdjust the configuration according to the error message until the destination service can receive a token."),(0,i.kt)("li",{parentName:"ul"},"The destination service is not bound to your application."),(0,i.kt)("li",{parentName:"ul"},"For ",(0,i.kt)("inlineCode",{parentName:"li"},"OnPremise")," destinations the connectivity service must be bound to your application."),(0,i.kt)("li",{parentName:"ul"},"The destination service is missing as a ",(0,i.kt)("a",{parentName:"li",href:"./tutorials/multi-tenant-application"},"dependency of your application"),".\nThis is only relevant in multi-tenant applications if you make the call via a subscriber account.")),(0,i.kt)("p",null,"If you are stuck in retrieving the destination, and you think the issue is caused by the SAP Cloud SDK, please ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/SAP/cloud-sdk-js/issues/new/choose"},"open an issue"),".\nPlease provide the information from you minimal example in the ticket."),(0,i.kt)("h3",{id:"fix-cloud-issues"},"Fix Cloud Issues"),(0,i.kt)("p",null,"You retrieved the destination but got an error when calling the cloud target system.\nThis can have multiple reasons:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The destination contains wrong user credentials or the user does not exist in the target system."),(0,i.kt)("li",{parentName:"ul"},"The user is locked in the target system."),(0,i.kt)("li",{parentName:"ul"},"The permissions of the user are insufficient."),(0,i.kt)("li",{parentName:"ul"},"The scopes of the JWT in the ",(0,i.kt)("inlineCode",{parentName:"li"},"authTokens")," are insufficient.")),(0,i.kt)("p",null,"If your request reaches the target system and gets rejected there, the problem most likely does not lie with the SAP Cloud SDK.\nThe error logs of the target system may provide additional information on the error."),(0,i.kt)("h3",{id:"activate-backend-logs"},"Activate Backend Logs"),(0,i.kt)("p",null,"You have a problem connecting to an On-premise system via a Cloud Connector and connectivity service.\nOften there is an issue in the Cloud Connector setup.\nTo see if a request reaches the backend system, activate the HTTP logs."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Go to transaction ",(0,i.kt)("strong",{parentName:"li"},"SMICM"),"."),(0,i.kt)("li",{parentName:"ol"},"Navigate to ",(0,i.kt)("strong",{parentName:"li"},"GOTO->Trace Level")," and set the trace level to 3 and activate HTTP logs.",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"You may want to reset the log file to have no old logs ",(0,i.kt)("strong",{parentName:"li"},"GOTO->Trace File"),"."))),(0,i.kt)("li",{parentName:"ol"},"Trigger your request."),(0,i.kt)("li",{parentName:"ol"},"Remember to switch back the trace level after you send the request."),(0,i.kt)("li",{parentName:"ol"},"Go to transaction ",(0,i.kt)("strong",{parentName:"li"},"ST11")," and investigate the file ",(0,i.kt)("inlineCode",{parentName:"li"},"dev_icm"))),(0,i.kt)("p",null,"If you see entries related to your request, your connection is working."),(0,i.kt)("h3",{id:"fix-connection-issues"},"Fix Connection Issues"),(0,i.kt)("p",null,"You have not found entries in the HTTP logs.\nThis means your request got stuck somewhere before."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Investigate the logs of the Cloud Connector and check the ",(0,i.kt)("a",{parentName:"li",href:"https://help.sap.com/docs/BTP/65de2977205c403bbc107264b8eccf4b/9b6510edf4d844a28f022b3db41f3202.html"},"documentation")," to fix problems."),(0,i.kt)("li",{parentName:"ul"},"The connectivity service is not bound to your application."),(0,i.kt)("li",{parentName:"ul"},"The connectivity service is missing as ",(0,i.kt)("a",{parentName:"li",href:"./tutorials/multi-tenant-application"},"dependency of your application"),".\nThis is only relevant in multi-tenant applications if you make the call via a subscriber account.")),(0,i.kt)("p",null,"If you keep experiencing problems, please reach out to the SAP BTP or Cloud Connector support."),(0,i.kt)("h3",{id:"fix-on-premise-issues"},"Fix On-Premise Issues"),(0,i.kt)("p",null,"Your request reaches the backend, but is rejected there.\nUsually the content of the ",(0,i.kt)("a",{parentName:"p",href:"#activate-backend-logs"},"HTTP logs")," should give you a hint what to do.\nIn the end requests get rejected for the same reasons as in the ",(0,i.kt)("a",{parentName:"p",href:"#fix-cloud-issues"},"cloud case"),".\nIn addition, there are On-premise specific problems:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The default client is not the client with your user and configuration.\nSet the ",(0,i.kt)("inlineCode",{parentName:"li"},"sap-client")," explicitly on the destination."),(0,i.kt)("li",{parentName:"ul"},"The principal propagation is more difficult to configure.\nIf a destination with basic authentication works you know for sure you have a problem with user propagation."),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("a",{parentName:"li",href:"https://help.sap.com/docs/SAP_NETWEAVER_AS_ABAP_FOR_SOH_740/d528eef3dca14679bcb47b069aa17a9d/c830fd902dc8473b9e59db1576cc784b.html?version=7.40.16&locale=en-US"},"user mapping")," is not correctly configured for principal propagation.")),(0,i.kt)("h3",{id:"find-difference"},"Find Difference"),(0,i.kt)("p",null,"The minimal example is working, but your real code is not.\nThis means the framework you are using is calling the SAP Cloud SDK in a different way than you are.\nAt this point, ",(0,i.kt)("a",{parentName:"p",href:"./guides/debug-remote-app"},"debug the application"),".\nTry to reach the point where the ",(0,i.kt)("inlineCode",{parentName:"p"},"executeHttpRequest()")," function of the SAP Cloud SDK is called and compare the argument to the one of the minimal example."),(0,i.kt)("p",null,"If you found the difference, try to align it or open an issue with the framework."))}h.isMDXComponent=!0}}]);