"use strict";(self.webpackChunksap_cloud_sdk_documentation=self.webpackChunksap_cloud_sdk_documentation||[]).push([[1884],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),l=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,p=d(e,["components","mdxType","originalType","parentName"]),c=l(n),m=a,h=c["".concat(s,".").concat(m)]||c[m]||u[m]||i;return n?r.createElement(h,o(o({ref:t},p),{},{components:n})):r.createElement(h,o({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=c;var d={};for(var s in t)hasOwnProperty.call(t,s)&&(d[s]=t[s]);d.originalType=e,d.mdxType="string"==typeof e?e:a,o[1]=d;for(var l=2;l<i;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},51668:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>d,toc:()=>l});var r=n(87462),a=(n(67294),n(3905));const i={id:"middleware",title:"Middleware",sidebar_label:"Middleware",description:"How the SAP Cloud SDK behaviour is adjusted using middlewares.",keywords:["sap","cloud","sdk","JavaScript","TypeScript","resilience","middleware"]},o=void 0,d={unversionedId:"features/middleware",id:"features/middleware",title:"Middleware",description:"How the SAP Cloud SDK behaviour is adjusted using middlewares.",source:"@site/docs-js/features/middleware.mdx",sourceDirName:"features",slug:"/features/middleware",permalink:"/cloud-sdk/docs/js/v3/features/middleware",draft:!1,editUrl:"https://github.com/SAP/cloud-sdk/edit/main/docs-js/features/middleware.mdx",tags:[],version:"current",frontMatter:{id:"middleware",title:"Middleware",sidebar_label:"Middleware",description:"How the SAP Cloud SDK behaviour is adjusted using middlewares.",keywords:["sap","cloud","sdk","JavaScript","TypeScript","resilience","middleware"]},sidebar:"docsJsSidebar",previous:{title:"Send e-mails",permalink:"/cloud-sdk/docs/js/v3/features/mail-client/"},next:{title:"Error Handling",permalink:"/cloud-sdk/docs/js/v3/features/error-handling"}},s={},l=[{value:"Concept",id:"concept",level:2},{value:"Example",id:"example",level:2}],p={toc:l};function u(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"concept"},"Concept"),(0,a.kt)("p",null,"The main purpose of the SAP Cloud SDK is to execute asynchronous HTTP requests.\nThis can either happen via a generated ",(0,a.kt)("a",{parentName:"p",href:"./odata/execute-request#setting-middlewares"},"OData")," or ",(0,a.kt)("a",{parentName:"p",href:"./openapi/execute-request#setting-middlewares"},"OpenAPI")," client or the ",(0,a.kt)("a",{parentName:"p",href:"./connectivity/http-client#setting-middlewares"},"http client"),".\nEither way, the final result after fetching destinations and doing various other things is an ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/axios/axios"},"axios")," request.\nSometimes you want to adjust the way the SAP Cloud SDK executes the axios request."),(0,a.kt)("p",null,"The middleware adds a very flexible way to add custom functionality to the request execution.\nThe API for the middleware is as follows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"export interface MiddlewareIn {\n  fn: () => Promise<HttpResponse>;\n  context: HttpMiddlewareContext;\n  skipNext: () => void;\n}\n\nexport type MiddlewareOut = () => Promise<HttpResponse>;\n\nexport type Middleware = (options: MiddlewareIn) => MiddlewareOut;\n")),(0,a.kt)("p",null,"The middleware receives a ",(0,a.kt)("inlineCode",{parentName:"p"},"MiddlewareIn")," option and returns a ",(0,a.kt)("inlineCode",{parentName:"p"},"MiddlewareOut"),".\nLet's investigate the different properties:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"fn")," handed in is the original HTTP request from the SAP Cloud SDK."),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"context")," provides information on the request like URL, headers and HTTP method."),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"skipNext")," will exit all following middlewares"),(0,a.kt)("li",{parentName:"ul"},"The ",(0,a.kt)("inlineCode",{parentName:"li"},"MiddlewareOut")," is the new function including the additional logic.")),(0,a.kt)("p",null,"This may seem abstract now, but the example in the next section will bring some concreteness to the topic."),(0,a.kt)("h2",{id:"example"},"Example"),(0,a.kt)("p",null,"As a simple example, assume you want to ensure that the response data contains only uppercase characters.\nA middleware doing that would look like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"const uppercaseMiddleware: Middleware = options => async () => {\n  const response = await options.fn();\n  return response.data.toUpperCase();\n};\n")),(0,a.kt)("p",null,"Add it to the request via the ",(0,a.kt)("inlineCode",{parentName:"p"},"middleware")," property as shown below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"const response = await executeHttpRequest(httpsDestination, {\n  middleware: [uppercaseMiddleware],\n  method: 'get'\n});\n")),(0,a.kt)("p",null,"You can add multiple middlewares that are added one by one to the request.\nThe execution order is from left to right in the array.\nAssume the response data of your request is ",(0,a.kt)("inlineCode",{parentName:"p"},"The answer to everything is:"),".\nDepending on the order of the middlewares, the result will be:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"const addFortyTwoMiddleware: Middleware = options => async () => {\n  const response = await options.fn();\n  return response.data + 'Forty-Two';\n};\n\nlet response = await executeHttpRequest(httpsDestination, {\n  middleware: [addFortyTwoMiddleware, uppercaseMiddleware],\n  method: 'get'\n});\n\nconsole.log(response.data); // 'THE ANSWER TO EVERYTHING IS: FORTY-TWO`\n\nresponse = await executeHttpRequest(httpsDestination, {\n  middleware: [uppercaseMiddleware, addFortyTwoMiddleware],\n  method: 'get'\n});\n\nconsole.log(response.data); // 'THE ANSWER TO EVERYTHING IS: Forty-Two.\n")),(0,a.kt)("p",null,"In the context of resilience, the order of middlewares becomes crucial.\nA timeout should be added first, then a circuit breaker followed by a retry.\nThe SAP Cloud SDK provides default resilience middlewares so that you do not have to worry about the details in most cases.\nYou can find detailed information on the resilience topic in a ",(0,a.kt)("a",{parentName:"p",href:"../guides/resilience"},"dedicated documentation"),"."))}u.isMDXComponent=!0}}]);